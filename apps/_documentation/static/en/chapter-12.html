<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Forms &mdash; py4web 1.20220222.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/toggle.css" type="text/css" />
    <link rel="shortcut icon" href="_static/logo-32x32.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/js/toggle.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Authentication and authorization" href="chapter-13.html" />
    <link rel="prev" title="Internationalization" href="chapter-11.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> py4web
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.20220222.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="chapter-01.html">What is py4web?</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter-02.html">Help, resources and hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter-03.html">Installation and Startup</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter-04.html">The Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter-05.html">Creating your first app</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter-06.html">Fixtures</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter-07.html">The Database Abstraction Layer (DAL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter-08.html">The RestAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter-09.html">YATL Template Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter-10.html">YATL helpers</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter-11.html">Internationalization</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Forms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-form-constructor">The Form constructor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-minimal-form-example-without-a-database">A minimal form example without a database</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basic-form-example">Basic form example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#file-upload-field">File upload field</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#widgets">Widgets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#standard-widgets">Standard widgets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-widgets">Custom widgets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-form-design">Advanced form design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#form-structure-manipulation">Form structure manipulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-forms">Custom forms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-sidecar-parameter">The sidecar parameter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#form-validation">Form validation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#text-format-validators">Text format validators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#is-alphanumeric"><code class="docutils literal notranslate"><span class="pre">IS_ALPHANUMERIC</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-lower"><code class="docutils literal notranslate"><span class="pre">IS_LOWER</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-upper"><code class="docutils literal notranslate"><span class="pre">IS_UPPER</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-email"><code class="docutils literal notranslate"><span class="pre">IS_EMAIL</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-match"><code class="docutils literal notranslate"><span class="pre">IS_MATCH</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-length"><code class="docutils literal notranslate"><span class="pre">IS_LENGTH</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-url"><code class="docutils literal notranslate"><span class="pre">IS_URL</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-slug"><code class="docutils literal notranslate"><span class="pre">IS_SLUG</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-json"><code class="docutils literal notranslate"><span class="pre">IS_JSON</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#date-and-time-validators">Date and time validators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#is-time"><code class="docutils literal notranslate"><span class="pre">IS_TIME</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-date"><code class="docutils literal notranslate"><span class="pre">IS_DATE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-datetime"><code class="docutils literal notranslate"><span class="pre">IS_DATETIME</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-date-in-range"><code class="docutils literal notranslate"><span class="pre">IS_DATE_IN_RANGE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-datetime-in-range"><code class="docutils literal notranslate"><span class="pre">IS_DATETIME_IN_RANGE</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#range-set-and-equality-validators">Range, set and equality validators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#is-equal-to"><code class="docutils literal notranslate"><span class="pre">IS_EQUAL_TO</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-not-empty"><code class="docutils literal notranslate"><span class="pre">IS_NOT_EMPTY</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-null-or"><code class="docutils literal notranslate"><span class="pre">IS_NULL_OR</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-empty-or"><code class="docutils literal notranslate"><span class="pre">IS_EMPTY_OR</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-expr"><code class="docutils literal notranslate"><span class="pre">IS_EXPR</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-decimal-in-range"><code class="docutils literal notranslate"><span class="pre">IS_DECIMAL_IN_RANGE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-float-in-range"><code class="docutils literal notranslate"><span class="pre">IS_FLOAT_IN_RANGE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-int-in-range"><code class="docutils literal notranslate"><span class="pre">IS_INT_IN_RANGE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-in-set"><code class="docutils literal notranslate"><span class="pre">IS_IN_SET</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#checkbox-validation">Checkbox validation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dictionaries-and-tuples-with-is-in-set">Dictionaries and tuples with IS_IN_SET</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sorted-options">Sorted options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-in-set-and-tagging"><code class="docutils literal notranslate"><span class="pre">IS_IN_SET</span></code> and Tagging</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#complexity-and-security-validators">Complexity and security validators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#is-strong"><code class="docutils literal notranslate"><span class="pre">IS_STRONG</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#crypt"><code class="docutils literal notranslate"><span class="pre">CRYPT</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#special-type-validators">Special type validators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#is-list-of"><code class="docutils literal notranslate"><span class="pre">IS_LIST_OF</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-list-of-emails"><code class="docutils literal notranslate"><span class="pre">IS_LIST_OF_EMAILS</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#any-of"><code class="docutils literal notranslate"><span class="pre">ANY_OF</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-image"><code class="docutils literal notranslate"><span class="pre">IS_IMAGE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-file"><code class="docutils literal notranslate"><span class="pre">IS_FILE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-upload-filename"><code class="docutils literal notranslate"><span class="pre">IS_UPLOAD_FILENAME</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-ipv4"><code class="docutils literal notranslate"><span class="pre">IS_IPV4</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-ipv6"><code class="docutils literal notranslate"><span class="pre">IS_IPV6</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-ipaddress"><code class="docutils literal notranslate"><span class="pre">IS_IPADDRESS</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#other-validators">Other validators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cleanup"><code class="docutils literal notranslate"><span class="pre">CLEANUP</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#database-validators">Database validators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#is-not-in-db"><code class="docutils literal notranslate"><span class="pre">IS_NOT_IN_DB</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-in-db"><code class="docutils literal notranslate"><span class="pre">IS_IN_DB</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#is-in-db-and-tagging"><code class="docutils literal notranslate"><span class="pre">IS_IN_DB</span></code> and Tagging</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#validation-functions">Validation functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="chapter-13.html">Authentication and authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter-14.html">Grid</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter-15.html">From web2py to py4web</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter-16.html">Advanced topics and examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">py4web</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Forms</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/web2py/py4web/blob/master/docs/chapter-12.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="forms">
<h1>Forms<a class="headerlink" href="#forms" title="Permalink to this headline"></a></h1>
<p>The Form class provides a high-level API for quickly building CRUD (create, update and delete) forms,
especially for working on an existing database table. It can generate and process a form from a
list of desired fields and/or from an existing database table.
It is a pretty much equivalent to web2py’s <code class="docutils literal notranslate"><span class="pre">SQLFORM</span></code>.</p>
<section id="the-form-constructor">
<h2>The Form constructor<a class="headerlink" href="#the-form-constructor" title="Permalink to this headline"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Form</span></code> constructor accepts the following arguments:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
     <span class="n">table</span><span class="p">,</span>
     <span class="n">record</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
     <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
     <span class="n">deletable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
     <span class="n">formstyle</span><span class="o">=</span><span class="n">FormStyleDefault</span><span class="p">,</span>
     <span class="n">dbio</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
     <span class="n">keep_values</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
     <span class="n">form_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
     <span class="n">hidden</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
     <span class="n">validation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
     <span class="n">csrf_session</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
     <span class="n">csrf_protection</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
     <span class="n">lifespan</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
     <span class="n">signing_info</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
     <span class="p">):</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">table</span></code>: a DAL table or a list of fields</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">record</span></code>: a DAL record or record id</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">readonly</span></code>: set to True to make a readonly form</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">deletable</span></code>: set to False to disallow deletion of record</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">formstyle</span></code>: a function that renders the form using helpers. Can be FormStyleDefault (default),
FormStyleBulma or FormStyleBootstrap4</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dbio</span></code>: set to False to prevent any DB writes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keep_values</span></code>: if set to true, it remembers the values of the previously submitted form</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">form_name</span></code>: the optional name of this form</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hidden</span></code>: a dictionary of hidden fields that is added to the form</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">validation</span></code>: an optional validator, see <a class="reference internal" href="#validation-functions"><span class="std std-ref">Validation functions</span></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">csrf_session</span></code>: if None, no csrf token is added.  If a session, then a CSRF token is added and verified</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lifespan</span></code>: lifespan of CSRF token in seconds, to limit form validity</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">signing_info</span></code>: information that should not change between when the CSRF token is signed and verified</p></li>
</ul>
</section>
<section id="a-minimal-form-example-without-a-database">
<h2>A minimal form example without a database<a class="headerlink" href="#a-minimal-form-example-without-a-database" title="Permalink to this headline"></a></h2>
<p>Let’s start with a minimal working form example.
Create a new minimal app called <code class="docutils literal notranslate"><span class="pre">form_minimal</span></code> :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># in form_minimal/__init__.py</span>
<span class="kn">from</span> <span class="nn">py4web</span> <span class="kn">import</span> <span class="n">action</span><span class="p">,</span> <span class="n">Field</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">URL</span>
<span class="kn">from</span> <span class="nn">py4web.utils.form</span> <span class="kn">import</span> <span class="n">Form</span>
<span class="kn">from</span> <span class="nn">pydal.validators</span> <span class="kn">import</span> <span class="n">IS_NOT_EMPTY</span>


<span class="nd">@action</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@action</span><span class="o">.</span><span class="n">uses</span><span class="p">(</span><span class="s1">&#39;form_minimal.html&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">Form</span><span class="p">([</span>
        <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;product_name&#39;</span><span class="p">),</span>
        <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;product_quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span><span class="p">()),</span>
        <span class="p">])</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">accepted</span><span class="p">:</span>
        <span class="c1"># Do something with form.vars[&#39;product_name&#39;] and form.vars[&#39;product_quantity&#39;]</span>
        <span class="n">redirect</span><span class="p">(</span><span class="n">URL</span><span class="p">(</span><span class="s1">&#39;accepted&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
        <span class="c1"># display message error</span>
        <span class="n">redirect</span><span class="p">(</span><span class="n">URL</span><span class="p">(</span><span class="s1">&#39;not_accepted&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>

<span class="nd">@action</span><span class="p">(</span><span class="s2">&quot;accepted&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">accepted</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;form_example accepted&quot;</span>


<span class="nd">@action</span><span class="p">(</span><span class="s2">&quot;not_accepted&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">not_accepted</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;form_example NOT accepted&quot;</span>
</pre></div>
</div>
<p>Also, you need to create a file inside the app called <code class="docutils literal notranslate"><span class="pre">templates/form_minimal.html</span></code>
that just contains the line:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>[[=form]]
</pre></div>
</div>
<p>Then reload py4web and visit <a class="reference external" href="http://127.0.0.1:8000/form_minimal">http://127.0.0.1:8000/form_minimal</a> - you’ll get the Form page:</p>
<img alt="_images/form1.png" src="_images/form1.png" />
<p>Note that:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Form</span></code> is a class contained in the <code class="docutils literal notranslate"><span class="pre">py4web.utils.form</span></code> module</p></li>
<li><p>it’s possible to use <strong>form validators</strong> like <code class="docutils literal notranslate"><span class="pre">IS_NOT_EMPTY</span></code>, see <a class="reference internal" href="#form-validation"><span class="std std-ref">Form validation</span></a> later.
They are imported from the <code class="docutils literal notranslate"><span class="pre">pydal.validators</span></code> module</p></li>
<li><p>it’s normally important to use both the <strong>GET</strong> and the <strong>POST</strong> methods in the action where
the form is contained</p></li>
</ul>
<p>This example is intentionally not using a database, a template, nor the session management.
The next example will.</p>
</section>
<section id="basic-form-example">
<h2>Basic form example<a class="headerlink" href="#basic-form-example" title="Permalink to this headline"></a></h2>
<p>In this next basic example we generate a form from a database.
Create a new minimal app called <code class="docutils literal notranslate"><span class="pre">form_basic</span></code> :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># in form_basic/__init__.py</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">py4web</span> <span class="kn">import</span> <span class="n">action</span><span class="p">,</span> <span class="n">Field</span><span class="p">,</span> <span class="n">DAL</span>
<span class="kn">from</span> <span class="nn">py4web.utils.form</span> <span class="kn">import</span> <span class="n">Form</span><span class="p">,</span> <span class="n">FormStyleDefault</span>
<span class="kn">from</span> <span class="nn">pydal.validators</span> <span class="kn">import</span> <span class="n">IS_NOT_EMPTY</span><span class="p">,</span> <span class="n">IS_IN_SET</span>

<span class="c1"># database definition</span>
<span class="n">DB_FOLDER</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;databases&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">DB_FOLDER</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">DB_FOLDER</span><span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">DAL</span><span class="p">(</span><span class="s1">&#39;sqlite://storage.sqlite&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">DB_FOLDER</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">define_table</span><span class="p">(</span>
    <span class="s1">&#39;person&#39;</span><span class="p">,</span>
    <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;superhero&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span><span class="p">()),</span>
    <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;realname&#39;</span><span class="p">),</span>
    <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;universe&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_IN_SET</span><span class="p">([</span><span class="s1">&#39;DC Comics&#39;</span><span class="p">,</span><span class="s1">&#39;Marvel Comics&#39;</span><span class="p">])),</span>
<span class="p">)</span>

<span class="c1"># controllers definition</span>
<span class="nd">@action</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="nd">@action</span><span class="o">.</span><span class="n">uses</span><span class="p">(</span><span class="s2">&quot;form_basic.html&quot;</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">Form</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">person</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">deletable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">formstyle</span><span class="o">=</span><span class="n">FormStyleDefault</span><span class="p">)</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">db</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">person</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">rows</span><span class="p">)</span>
</pre></div>
</div>
<p>Because this is a dual purpose form, in case an <code class="docutils literal notranslate"><span class="pre">id</span></code> is passed, we also validate it
by checking if the corresponding record exists and raise 404 if not.</p>
<p>Note the import of two simple validators on top, in order to be used later
with the <code class="docutils literal notranslate"><span class="pre">requires</span></code> parameter. We’ll fully explain them
on the <a class="reference internal" href="#form-validation"><span class="std std-ref">Form validation</span></a> paragraph.</p>
<p>You will also need a template file <code class="docutils literal notranslate"><span class="pre">templates/form_basic.html</span></code> that
contains, for example, the following code:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">h2</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span>Form Basic example: Superhero Identity<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

[[=form]]

<span class="p">&lt;</span><span class="nt">h2</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span>Rows<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
[[for row in rows:]]
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>[[=row.id]]: [[=row.superhero]] ([[=row.realname]]) from [[=row.universe]]<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
[[pass]]
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Reload py4web and visit <a class="reference external" href="http://127.0.0.1:8000/form_basic">http://127.0.0.1:8000/form_basic</a> :
the result is an input form on the top of the page, and the list of all the
previously added entries on the bottom:</p>
<img alt="_images/form2.png" src="_images/form2.png" />
<p>This is a simple example and you cannot change nor delete existing records. But if you’d
like to experiment, the database content can be fully seen and changed with the Dashboard app.</p>
<p>Notice that py4web by default let you choose the value of the <cite>universe</cite> field using
a dropdown menu:</p>
<img alt="_images/form3.png" src="_images/form3.png" />
<p>The basic form usage is quite useful for rapid prototyping of programs, since you don’t need
to specify the layout of the form. On the other hand, you cannot change its default behaviour.</p>
<section id="file-upload-field">
<h3>File upload field<a class="headerlink" href="#file-upload-field" title="Permalink to this headline"></a></h3>
<p>The file upload field is quite particular. The standard way to use it (as in the _scaffold app)
is to have the UPLOAD_FOLDER defined in the common.py file. But if you don’t specify it, then the
default value of  <code class="docutils literal notranslate"><span class="pre">your_app/upload</span></code> folder will be used (and the folder will also be created if needed).
Let’s look at a simple example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># in form_upload/__init__.py</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">py4web.core</span> <span class="kn">import</span> <span class="n">required_folder</span>
<span class="kn">from</span> <span class="nn">py4web</span> <span class="kn">import</span> <span class="n">action</span><span class="p">,</span> <span class="n">Field</span><span class="p">,</span> <span class="n">DAL</span>
<span class="kn">from</span> <span class="nn">py4web.utils.form</span> <span class="kn">import</span> <span class="n">Form</span><span class="p">,</span> <span class="n">FormStyleDefault</span>
<span class="kn">from</span> <span class="nn">pydal.validators</span> <span class="kn">import</span> <span class="n">IS_NOT_EMPTY</span>

<span class="c1"># database definition</span>
<span class="n">DB_FOLDER</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;databases&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">DB_FOLDER</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">DB_FOLDER</span><span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">DAL</span><span class="p">(</span><span class="s1">&#39;sqlite://storage.sqlite&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">DB_FOLDER</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">define_table</span><span class="p">(</span>
    <span class="s1">&#39;person&#39;</span><span class="p">,</span>
    <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;superhero&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span><span class="p">()),</span>
    <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="s2">&quot;upload&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Superhero Image&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span><span class="p">()),</span>
<span class="p">)</span>

<span class="nd">@action</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="nd">@action</span><span class="o">.</span><span class="n">uses</span><span class="p">(</span><span class="s2">&quot;form_upload.html&quot;</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">upload</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">Form</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">person</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">deletable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">formstyle</span><span class="o">=</span><span class="n">FormStyleDefault</span><span class="p">)</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">db</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">person</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">rows</span><span class="p">)</span>
</pre></div>
</div>
<p>And in templates/form_upload.html :</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">h2</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span>Form upload example: Superhero Identity<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

[[=form]]

<span class="p">&lt;</span><span class="nt">h2</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span>Rows<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
[[for row in rows:]]
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>[[=row.id]]: [[=row.superhero]] = [[=row.image]]<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
[[pass]]
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>This gives a result like the following:</p>
<img alt="_images/form6.png" src="_images/form6.png" />
<p>Note that the uploaded files will be saved on the UPLOAD_FOLDER folder with their name hashed.
Other details on the upload fields can be found on <a class="reference internal" href="chapter-07.html#field-constructor"><span class="std std-ref">Field constructor</span></a> paragraph, including
a way to save the files inside the database itself.</p>
</section>
</section>
<section id="widgets">
<h2>Widgets<a class="headerlink" href="#widgets" title="Permalink to this headline"></a></h2>
<section id="standard-widgets">
<h3>Standard widgets<a class="headerlink" href="#standard-widgets" title="Permalink to this headline"></a></h3>
<p>Py4web provides many widgets in the py4web.utility.form library. They are simple plugins
that easily allow you to specify the type of the input elements in a form, along with
some of their properties.</p>
<p>Here is the full list:</p>
<ul class="simple">
<li><p>CheckboxWidget</p></li>
<li><p>DateTimeWidget</p></li>
<li><p>FileUploadWidget</p></li>
<li><p>ListWidget</p></li>
<li><p>PasswordWidget</p></li>
<li><p>RadioWidget</p></li>
<li><p>SelectWidget</p></li>
<li><p>TextareaWidget</p></li>
</ul>
<p>This is an improved ‘Basic Form Example’ with a radio button widget:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># in form_widgets/__init__.py</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">py4web</span> <span class="kn">import</span> <span class="n">action</span><span class="p">,</span> <span class="n">Field</span><span class="p">,</span> <span class="n">DAL</span>
<span class="kn">from</span> <span class="nn">py4web.utils.form</span> <span class="kn">import</span> <span class="n">Form</span><span class="p">,</span> <span class="n">FormStyleDefault</span><span class="p">,</span> <span class="n">RadioWidget</span>
<span class="kn">from</span> <span class="nn">pydal.validators</span> <span class="kn">import</span> <span class="n">IS_NOT_EMPTY</span><span class="p">,</span> <span class="n">IS_IN_SET</span>

<span class="c1"># database definition</span>
<span class="n">DB_FOLDER</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;databases&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">DB_FOLDER</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">DB_FOLDER</span><span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">DAL</span><span class="p">(</span><span class="s1">&#39;sqlite://storage.sqlite&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">DB_FOLDER</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">define_table</span><span class="p">(</span>
    <span class="s1">&#39;person&#39;</span><span class="p">,</span>
    <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;superhero&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span><span class="p">()),</span>
    <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;realname&#39;</span><span class="p">),</span>
    <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;universe&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_IN_SET</span><span class="p">([</span><span class="s1">&#39;DC Comics&#39;</span><span class="p">,</span><span class="s1">&#39;Marvel Comics&#39;</span><span class="p">])),</span>
<span class="p">)</span>

<span class="c1"># controllers definition</span>
<span class="nd">@action</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="nd">@action</span><span class="o">.</span><span class="n">uses</span><span class="p">(</span><span class="s2">&quot;form_widgets.html&quot;</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">FormStyleDefault</span><span class="o">.</span><span class="n">widgets</span><span class="p">[</span><span class="s1">&#39;universe&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">RadioWidget</span><span class="p">()</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">Form</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">person</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">deletable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">formstyle</span><span class="o">=</span><span class="n">FormStyleDefault</span><span class="p">)</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">db</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">person</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">rows</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice the differences from the ‘Basic Form example’ we’ve seen at the
beginning of the chapter:</p>
<ul>
<li><p>you need to import the widget from the py4web.utils.form library</p></li>
<li><p>before the form definition, you define the <code class="docutils literal notranslate"><span class="pre">universe</span></code> field form style with the line:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">FormStyleDefault</span><span class="o">.</span><span class="n">widgets</span><span class="p">[</span><span class="s1">&#39;universe&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">RadioWidget</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>You will also need a template file <code class="docutils literal notranslate"><span class="pre">templates/form_widgets.html</span></code> that
contains the following code (as the form_basic.html) :</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">h2</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span>Form Widget example: Superhero Identity<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

[[=form]]

<span class="p">&lt;</span><span class="nt">h2</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span>Rows<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
[[for row in rows:]]
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>[[=row.id]]: [[=row.superhero]] ([[=row.realname]]) from [[=row.universe]]<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
[[pass]]
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>The result is the same as before, but now we have a radio button widget instead of the
dropdown menu!</p>
<img alt="_images/form4.png" src="_images/form4.png" />
<p>Using widgets in forms is quite easy, and they’ll let you have more control on its pieces.</p>
</section>
<section id="custom-widgets">
<h3>Custom widgets<a class="headerlink" href="#custom-widgets" title="Permalink to this headline"></a></h3>
<p>You can also customize the widgets properties by subclassing the FormStyleDefault class. Let’s have a quick look,
improving again our Superhero example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># in form_custom_widgets/__init__.py</span>
<span class="c1">#</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">py4web</span> <span class="kn">import</span> <span class="n">action</span><span class="p">,</span> <span class="n">Field</span><span class="p">,</span> <span class="n">DAL</span>
<span class="kn">from</span> <span class="nn">py4web.utils.form</span> <span class="kn">import</span> <span class="n">Form</span><span class="p">,</span> <span class="n">FormStyleDefault</span><span class="p">,</span> <span class="n">RadioWidget</span>
<span class="kn">from</span> <span class="nn">pydal.validators</span> <span class="kn">import</span> <span class="n">IS_NOT_EMPTY</span><span class="p">,</span> <span class="n">IS_IN_SET</span>
<span class="kn">from</span> <span class="nn">yatl.helpers</span> <span class="kn">import</span> <span class="n">INPUT</span><span class="p">,</span> <span class="n">DIV</span>

<span class="c1"># database definition</span>
<span class="n">DB_FOLDER</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;databases&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">DB_FOLDER</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">DB_FOLDER</span><span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">DAL</span><span class="p">(</span><span class="s1">&#39;sqlite://storage.sqlite&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">DB_FOLDER</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">define_table</span><span class="p">(</span>
    <span class="s1">&#39;person&#39;</span><span class="p">,</span>
    <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;superhero&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span><span class="p">()),</span>
    <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;realname&#39;</span><span class="p">),</span>
    <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;universe&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_IN_SET</span><span class="p">([</span><span class="s1">&#39;DC Comics&#39;</span><span class="p">,</span><span class="s1">&#39;Marvel Comics&#39;</span><span class="p">])),</span>
<span class="p">)</span>

<span class="c1"># custom widget class definition</span>
<span class="k">class</span> <span class="nc">MyCustomWidget</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">placeholder</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">tablename</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">_table</span> <span class="k">if</span> <span class="s2">&quot;_table&quot;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;no_table&quot;</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">INPUT</span><span class="p">(</span>
            <span class="n">_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="n">_id</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tablename</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
            <span class="n">_name</span><span class="o">=</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">_value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
            <span class="n">_class</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span>
            <span class="n">_placeholder</span><span class="o">=</span><span class="n">placeholder</span> <span class="k">if</span> <span class="n">placeholder</span> <span class="ow">and</span> <span class="n">placeholder</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span>
            <span class="n">_title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">_style</span><span class="o">=</span><span class="s2">&quot;font-size: x-large;color: red; background-color: black;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">control</span>

<span class="c1"># controllers definition</span>
<span class="nd">@action</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="nd">@action</span><span class="o">.</span><span class="n">uses</span><span class="p">(</span><span class="s2">&quot;form_custom_widgets.html&quot;</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">MyStyle</span> <span class="o">=</span> <span class="n">FormStyleDefault</span>
    <span class="n">MyStyle</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="n">FormStyleDefault</span><span class="o">.</span><span class="n">classes</span>
    <span class="n">MyStyle</span><span class="o">.</span><span class="n">widgets</span><span class="p">[</span><span class="s1">&#39;superhero&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">MyCustomWidget</span><span class="p">()</span>
    <span class="n">MyStyle</span><span class="o">.</span><span class="n">widgets</span><span class="p">[</span><span class="s1">&#39;realname&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">MyCustomWidget</span><span class="p">()</span>
    <span class="n">MyStyle</span><span class="o">.</span><span class="n">widgets</span><span class="p">[</span><span class="s1">&#39;universe&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">RadioWidget</span><span class="p">()</span>

    <span class="n">form</span> <span class="o">=</span> <span class="n">Form</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">person</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">deletable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">formstyle</span><span class="o">=</span><span class="n">MyStyle</span><span class="p">)</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">db</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">person</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">rows</span><span class="p">)</span>
</pre></div>
</div>
<p>You will also need a template file <code class="docutils literal notranslate"><span class="pre">templates/form_custom_widgets.html</span></code> that
contains the following code (as the form_basic.html) :</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">h2</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span>Form Custom Widgets example: Superhero Identity<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

[[=form]]

<span class="p">&lt;</span><span class="nt">h2</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span>Rows<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
[[for row in rows:]]
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>[[=row.id]]: [[=row.superhero]]  ([[=row.realname]]) from [[=row.universe]] <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
[[pass]]
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>The result is similar to the previous ones, but now we have a custom input field,
with foreground color red and background color black:</p>
<img alt="_images/form5.png" src="_images/form5.png" />
<p>Even the radio button widget has changed, from red to blue.</p>
</section>
</section>
<section id="advanced-form-design">
<h2>Advanced form design<a class="headerlink" href="#advanced-form-design" title="Permalink to this headline"></a></h2>
<section id="form-structure-manipulation">
<h3>Form structure manipulation<a class="headerlink" href="#form-structure-manipulation" title="Permalink to this headline"></a></h3>
<p>In py4web a form is rendered by YATL helpers. This means the tree structure of a form
can be manipulated before the form is serialized in HTML.
Here is an example of how to manipulate the generate HTML structure:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">define_table</span><span class="p">(</span><span class="s1">&#39;paint&#39;</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">))</span>
<span class="n">form</span> <span class="o">=</span> <span class="n">Form</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">paint</span><span class="p">)</span>
<span class="n">form</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;[name=color]&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;my-class&#39;</span>
</pre></div>
</div>
<p>Notice that a form does not make an HTML tree until form structure is accessed. Once accessed you can use <code class="docutils literal notranslate"><span class="pre">.find(...)</span></code>
to find matching elements. The argument of <code class="docutils literal notranslate"><span class="pre">find</span></code> is a string following the filter syntax of jQuery. In the above case
there is a single match <code class="docutils literal notranslate"><span class="pre">[0]</span></code> and we modify the <code class="docutils literal notranslate"><span class="pre">_class</span></code> attribute of that element. Attribute names of HTML elements
must be preceded by an underscore.</p>
</section>
<section id="custom-forms">
<h3>Custom forms<a class="headerlink" href="#custom-forms" title="Permalink to this headline"></a></h3>
<p>Custom forms allow you to granulary control how the form is processed. In the template file, you can execute specific
instructions before the form is displayed or after its data submission by inserting code among the following statements:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>[[=form.custom.begin ]]
[[=form.custom.submit ]]
[[=form.custom.end ]]
</pre></div>
</div>
<p>For example you could use it to avoid displaying the <code class="docutils literal notranslate"><span class="pre">id</span></code> field while editing a record in your form:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>[[=form.custom.begin ]]
    [[for field in DETAIL_FIELDS: ]]
        [[ if field not in [&#39;id&#39;]: ]]
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;select&quot;</span><span class="p">&gt;</span>
                [[=form.custom.widgets[field] ]]
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        [[pass]]
    [[pass]]
[[=form.custom.submit ]]
[[=form.custom.end ]]
</pre></div>
</div>
<p>Custom forms are also frequently used for avoiding code redundancy; you can use a single template file for
multiple form types, and programmatically change the fields contained and how to render them.</p>
<p>Note: ‘custom’ is just a convention, it could be any name that does not clash with already defined objects.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When working with custom forms, if you have a writable field that isn’t included on your
form, it will be set to null when you save a record.  Any time a field is not included
on a custom form, it should be set field.writable=False to ensure that field is not updated.</p>
<p>Also, custom forms only create the element for a given field, but no surrounding elements
that might be needed based on your css framework.  For example, if you’re using Bulma as
your css framework, you’ll have to add an outer DIV in order to get select controls to
appear correctly.</p>
</div>
</section>
<section id="the-sidecar-parameter">
<h3>The sidecar parameter<a class="headerlink" href="#the-sidecar-parameter" title="Permalink to this headline"></a></h3>
<p>The sidecar is the stuff injected in the form along with the submit button.</p>
<p>For example, you can inject a simple <code class="docutils literal notranslate"><span class="pre">click</span> <span class="pre">me</span></code> button in your form with the following
code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">form</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">sidecar</span> <span class="o">=</span> <span class="n">DIV</span><span class="p">(</span><span class="n">BUTTON</span><span class="p">(</span><span class="s2">&quot;click me&quot;</span><span class="p">,</span> <span class="n">_onclick</span><span class="o">=</span><span class="s2">&quot;alert(&#39;doh!&#39;)&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>In particular, this is frequently used for adding a <code class="docutils literal notranslate"><span class="pre">Cancel</span></code> button, which is not provided by py4web:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span>
<span class="s2">&quot;_onclick&quot;</span><span class="p">:</span> <span class="s2">&quot;window.history.back(); return false;&quot;</span><span class="p">,</span>
<span class="s2">&quot;_class&quot;</span><span class="p">:</span> <span class="s2">&quot;button is-default&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">form</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">sidecar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BUTTON</span><span class="p">(</span><span class="s2">&quot;Cancel&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
<section id="form-validation">
<h2>Form validation<a class="headerlink" href="#form-validation" title="Permalink to this headline"></a></h2>
<p>Validators are classes used to validate input fields (including forms generated from database tables).
They are normally assigned using the <code class="docutils literal notranslate"><span class="pre">requires</span></code> attribute of a table <code class="docutils literal notranslate"><span class="pre">Field</span></code> object, as already
shown on the <a class="reference internal" href="chapter-07.html#field-constructor"><span class="std std-ref">Field constructor</span></a> paragraph of the DAL chapter. Also, you can use advanced validators
in order to create widgets such as drop-down menus, radio buttons and even lookups from other tables.
Last but not least, you can even explicitly define a validation function.</p>
<p>Here is a simple example of how to require a validator for a table field:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">define_table</span><span class="p">(</span>
    <span class="s1">&#39;person&#39;</span><span class="p">,</span>
    <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span><span class="p">(),</span>
    <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The validator is frequently
written explicitly outside the table definition in this equivalent syntax:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">define_table</span><span class="p">(</span>
    <span class="s1">&#39;person&#39;</span><span class="p">,</span>
    <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span>
    <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_NOT_EMPTY</span><span class="p">()</span>
</pre></div>
</div>
<p>A field can have a single validator or a list of multiple validators:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">requires</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">IS_NOT_EMPTY</span><span class="p">(),</span>
    <span class="n">IS_NOT_IN_DB</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s1">&#39;person.name&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Mind that the only validators that can be used with <code class="docutils literal notranslate"><span class="pre">list:</span></code> type fields are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">IS_IN_DB(...,</span> <span class="pre">multiple=True)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IS_IN_SET(...,</span> <span class="pre">multiple=True)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IS_NOT_EMPTY()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IS_LIST_OF_EMAILS()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IS_LIST_OF(...)</span></code></p></li>
</ul>
<p>The latter can be used to apply any validator to the individual items in the list.
<code class="docutils literal notranslate"><span class="pre">multiple=(1,</span> <span class="pre">1000)</span></code> requires a selection of between 1 and 1000 items.
This enforces selection of at least one choice.</p>
<p>Built-in validators have constructors that take an <code class="docutils literal notranslate"><span class="pre">error_message</span></code> argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">IS_NOT_EMPTY</span><span class="p">(</span><span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;cannot be empty!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice the error message is usually fist option of the constructors and you can normally
avoid to name it. Hence the following syntax is equivalent:</p>
<p>If you want to use internationalization like explained in a previous chapter you need to
define your own messages and wrap the validator message in the T operator:</p>
<blockquote>
<div><p>IS_NOT_EMPTY(error_message=T(‘cannot be empty!’))</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">IS_NOT_EMPTY</span><span class="p">(</span><span class="s1">&#39;cannot be empty!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is an example of a validator on a database table:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_NOT_EMPTY</span><span class="p">(</span><span class="n">error_message</span><span class="o">=</span><span class="n">T</span><span class="p">(</span><span class="s1">&#39;fill this!&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>where we have used the translation operator <code class="docutils literal notranslate"><span class="pre">T</span></code> to allow for internationalization.
Notice that error messages are not translated by default unless you define them explicitly with <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p>
<p>One can also call validators explicitly for a field:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>which returns a tuple <code class="docutils literal notranslate"><span class="pre">(value,</span> <span class="pre">error)</span></code> and <code class="docutils literal notranslate"><span class="pre">error</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code> if the value validates.</p>
<p>You can easily test most of the following validators directly using python only.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pydal.validators</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">IS_ALPHANUMERIC</span><span class="p">()(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="go">(&#39;test&#39;, None)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">IS_ALPHANUMERIC</span><span class="p">()(</span><span class="s1">&#39;test!&#39;</span><span class="p">)</span>
<span class="go">(&#39;test!&#39;, &#39;Enter only letters, numbers, and underscore&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">IS_ALPHANUMERIC</span><span class="p">(</span><span class="s1">&#39;this is not alphanumeric&#39;</span><span class="p">)(</span><span class="s1">&#39;test!&#39;</span><span class="p">)</span>
<span class="go">(&#39;test!&#39;, &#39;this is not alphanumeric&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">IS_ALPHANUMERIC</span><span class="p">(</span><span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;this is not alphanumeric&#39;</span><span class="p">)(</span><span class="s1">&#39;test!&#39;</span><span class="p">)</span>
<span class="go">(&#39;test!&#39;, &#39;this is not alphanumeric&#39;)</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>The DAL validators are well documented inside the python source code. You can easily check it by yourself for all the details!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydal</span> <span class="kn">import</span> <span class="n">validators</span>
<span class="nb">dir</span><span class="p">(</span><span class="n">validators</span><span class="p">)</span> <span class="c1"># get the list of all validators</span>
<span class="n">help</span><span class="p">(</span><span class="n">validators</span><span class="o">.</span><span class="n">IS_URL</span><span class="p">)</span> <span class="c1"># get specific help for the IS_URL validator</span>
</pre></div>
</div>
</div>
<section id="text-format-validators">
<h3>Text format validators<a class="headerlink" href="#text-format-validators" title="Permalink to this headline"></a></h3>
<section id="is-alphanumeric">
<h4><code class="docutils literal notranslate"><span class="pre">IS_ALPHANUMERIC</span></code><a class="headerlink" href="#is-alphanumeric" title="Permalink to this headline"></a></h4>
<p>This validator checks that a field value contains only characters in the ranges a-z, A-Z, or 0-9.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_ALPHANUMERIC</span><span class="p">(</span><span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;must be alphanumeric!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="is-lower">
<h4><code class="docutils literal notranslate"><span class="pre">IS_LOWER</span></code><a class="headerlink" href="#is-lower" title="Permalink to this headline"></a></h4>
<p>This validator never returns an error. It just converts the value to lower case.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_LOWER</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="is-upper">
<h4><code class="docutils literal notranslate"><span class="pre">IS_UPPER</span></code><a class="headerlink" href="#is-upper" title="Permalink to this headline"></a></h4>
<p>This validator never returns an error. It converts the value to upper case.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_UPPER</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="is-email">
<h4><code class="docutils literal notranslate"><span class="pre">IS_EMAIL</span></code><a class="headerlink" href="#is-email" title="Permalink to this headline"></a></h4>
<p>It checks that the field value looks like an email address. It does not try to send email to confirm.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_EMAIL</span><span class="p">(</span><span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;invalid email!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="is-match">
<h4><code class="docutils literal notranslate"><span class="pre">IS_MATCH</span></code><a class="headerlink" href="#is-match" title="Permalink to this headline"></a></h4>
<p>This validator matches the value against a regular expression and returns an error if it does not match.
Here is an example of usage to validate a US zip code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_MATCH</span><span class="p">(</span><span class="s1">&#39;^\d</span><span class="si">{5}</span><span class="s1">(-\d</span><span class="si">{4}</span><span class="s1">)?$&#39;</span><span class="p">,</span>
    <span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;not a zip code&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is an example of usage to validate an IPv4 address (note: the IS_IPV4 validator is more appropriate for this purpose):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_MATCH</span><span class="p">(</span><span class="s1">&#39;^\d{1,3}(\.\d{1,3})</span><span class="si">{3}</span><span class="s1">$&#39;</span><span class="p">,</span>
        <span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;not an IP address&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is an example of usage to validate a US phone number:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_MATCH</span><span class="p">(</span><span class="s1">&#39;^1?((-)\d</span><span class="si">{3}</span><span class="s1">-?|\(\d</span><span class="si">{3}</span><span class="s1">\))\d</span><span class="si">{3}</span><span class="s1">-?\d</span><span class="si">{4}</span><span class="s1">$&#39;</span><span class="p">,</span>
        <span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;not a phone number&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For more information on Python regular expressions, refer to the official Python documentation.</p>
<p><code class="docutils literal notranslate"><span class="pre">IS_MATCH</span></code> takes an optional argument <code class="docutils literal notranslate"><span class="pre">strict</span></code> which defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>. When set to <code class="docutils literal notranslate"><span class="pre">True</span></code> it only matches the whole string (from the beginning to the end):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">IS_MATCH</span><span class="p">(</span><span class="s1">&#39;ab&#39;</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
<span class="go">(&#39;abc&#39;, None)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">IS_MATCH</span><span class="p">(</span><span class="s1">&#39;ab&#39;</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
<span class="go">(&#39;abc&#39;, &#39;Invalid expression&#39;)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">IS_MATCH</span></code> takes an other optional argument <code class="docutils literal notranslate"><span class="pre">search</span></code> which defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>. When set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, it uses regex method <code class="docutils literal notranslate"><span class="pre">search</span></code> instead of method <code class="docutils literal notranslate"><span class="pre">match</span></code> to validate the string.</p>
<p><code class="docutils literal notranslate"><span class="pre">IS_MATCH('...',</span> <span class="pre">extract=True)</span></code> filters and extract only the first matching
substring rather than the original value.</p>
</section>
<section id="is-length">
<h4><code class="docutils literal notranslate"><span class="pre">IS_LENGTH</span></code><a class="headerlink" href="#is-length" title="Permalink to this headline"></a></h4>
<p>Checks if length of field’s value fits between given boundaries. Works
for both text and file inputs.</p>
<p>Its arguments are:</p>
<ul class="simple">
<li><p>maxsize: the maximum allowed length / size (has default = 255)</p></li>
<li><p>minsize: the minimum allowed length / size</p></li>
</ul>
<p>Examples:
Check if text string is shorter than 16 characters:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">IS_LENGTH</span><span class="p">(</span><span class="mi">15</span><span class="p">)(</span><span class="s1">&#39;example string&#39;</span><span class="p">)</span>
<span class="go">(&#39;example string&#39;, None)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">IS_LENGTH</span><span class="p">(</span><span class="mi">15</span><span class="p">)(</span><span class="s1">&#39;example long string&#39;</span><span class="p">)</span>
<span class="go">(&#39;example long string&#39;, &#39;Enter from 0 to 15 characters&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">IS_LENGTH</span><span class="p">(</span><span class="mi">15</span><span class="p">)(</span><span class="s1">&#39;33&#39;</span><span class="p">)</span>
<span class="go">(&#39;33&#39;, None)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">IS_LENGTH</span><span class="p">(</span><span class="mi">15</span><span class="p">)(</span><span class="mi">33</span><span class="p">)</span>
<span class="go">(&#39;33&#39;, None)</span>
</pre></div>
</div>
<p>Check if uploaded file has size between 1KB and 1MB:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INPUT</span><span class="p">(</span><span class="n">_type</span><span class="o">=</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">_name</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_LENGTH</span><span class="p">(</span><span class="mi">1048576</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span>
</pre></div>
</div>
<p>For all field types except for files, it checks the length of the value.
In the case of files, the value is a <code class="docutils literal notranslate"><span class="pre">cgi.FieldStorage</span></code>, so it validates the
length of the data in the file, which is the behavior one might intuitively expect.</p>
</section>
<section id="is-url">
<h4><code class="docutils literal notranslate"><span class="pre">IS_URL</span></code><a class="headerlink" href="#is-url" title="Permalink to this headline"></a></h4>
<p>Rejects a URL string if any of the following is true:</p>
<ul class="simple">
<li><p>The string is empty or None</p></li>
<li><p>The string uses characters that are not allowed in a URL</p></li>
<li><p>The string breaks any of the HTTP syntactic rules</p></li>
<li><p>The URL scheme specified (if one is specified) is not ‘http’ or ‘https’</p></li>
<li><p>The top-level domain (if a host name is specified) does not exist</p></li>
</ul>
<p>(These rules are based on <code class="docutils literal notranslate"><span class="pre">RFC</span> <span class="pre">2616</span></code>)</p>
<p>This function only checks the URL’s syntax. It does not check that the URL points to a real document,
for example, or that it otherwise makes semantic sense. This function does automatically prepend
‘<a class="reference external" href="http://">http://</a>’ in front of a URL in the case of an abbreviated URL (e.g. ‘google.ca’).
If the parameter <code class="docutils literal notranslate"><span class="pre">mode='generic'</span></code> is used, then this function’s behavior changes. It then rejects a URL
string if any of the following is true:</p>
<ul class="simple">
<li><p>The string is empty or None</p></li>
<li><p>The string uses characters that are not allowed in a URL</p></li>
<li><p>The URL scheme specified (if one is specified) is not valid</p></li>
</ul>
<p>(These rules are based on <code class="docutils literal notranslate"><span class="pre">RFC</span> <span class="pre">2396</span></code>)</p>
<p>The list of allowed schemes is customizable with the allowed_schemes parameter. If you exclude None from
the list, then abbreviated URLs (lacking a scheme such as ‘http’) will be rejected.</p>
<p>The default prepended scheme is customizable with the prepend_scheme parameter. If you set prepend_scheme
to None, then prepending will be disabled. URLs that require prepending to parse will still be accepted,
but the return value will not be modified.</p>
<p>IS_URL is compatible with the Internationalized Domain Name (IDN) standard specified in <code class="docutils literal notranslate"><span class="pre">RFC</span> <span class="pre">3490</span></code>).
As a result, URLs can be regular strings or unicode strings.
If the URL’s domain component (e.g. google.ca) contains non-US-ASCII letters, then the domain will
be converted into Punycode (defined in <code class="docutils literal notranslate"><span class="pre">RFC</span> <span class="pre">3492</span></code>). IS_URL goes a
bit beyond the standards, and allows non-US-ASCII characters to be present in the path
and query components of the URL as well. These non-US-ASCII characters will be encoded.
For example, space will be encoded as’%20’. The unicode character with hex code 0x4e86
will become ‘%4e%86’.</p>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_URL</span><span class="p">())</span>
<span class="n">requires</span> <span class="o">=</span> <span class="n">IS_URL</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;generic&#39;</span><span class="p">)</span>
<span class="n">requires</span> <span class="o">=</span> <span class="n">IS_URL</span><span class="p">(</span><span class="n">allowed_schemes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;https&#39;</span><span class="p">])</span>
<span class="n">requires</span> <span class="o">=</span> <span class="n">IS_URL</span><span class="p">(</span><span class="n">prepend_scheme</span><span class="o">=</span><span class="s1">&#39;https&#39;</span><span class="p">)</span>
<span class="n">requires</span> <span class="o">=</span> <span class="n">IS_URL</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;generic&#39;</span><span class="p">,</span>
                <span class="n">allowed_schemes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ftps&#39;</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">],</span>
                <span class="n">prepend_scheme</span><span class="o">=</span><span class="s1">&#39;https&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="is-slug">
<h4><code class="docutils literal notranslate"><span class="pre">IS_SLUG</span></code><a class="headerlink" href="#is-slug" title="Permalink to this headline"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_SLUG</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;must be slug&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">check</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> it check whether the validated value is a slug (allowing only alphanumeric characters and non-repeated dashes).</p>
<p>If <code class="docutils literal notranslate"><span class="pre">check</span></code> is set to <code class="docutils literal notranslate"><span class="pre">False</span></code> (default) it converts the input value to a slug.</p>
</section>
<section id="is-json">
<h4><code class="docutils literal notranslate"><span class="pre">IS_JSON</span></code><a class="headerlink" href="#is-json" title="Permalink to this headline"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_JSON</span><span class="p">(</span><span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;Invalid json&#39;</span><span class="p">,</span> <span class="n">native_json</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>This validator checks that a field value is in JSON format.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">native_json</span></code> is set to <code class="docutils literal notranslate"><span class="pre">False</span></code> (default) it converts the input value to the serialized value otherwise the input value is left unchanged.</p>
</section>
</section>
<section id="date-and-time-validators">
<h3>Date and time validators<a class="headerlink" href="#date-and-time-validators" title="Permalink to this headline"></a></h3>
<section id="is-time">
<h4><code class="docutils literal notranslate"><span class="pre">IS_TIME</span></code><a class="headerlink" href="#is-time" title="Permalink to this headline"></a></h4>
<p>This validator checks that a field value contains a valid time in the specified format.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_TIME</span><span class="p">(</span><span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;must be HH:MM:SS!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="is-date">
<h4><code class="docutils literal notranslate"><span class="pre">IS_DATE</span></code><a class="headerlink" href="#is-date" title="Permalink to this headline"></a></h4>
<p>This validator checks that a field value contains a valid date in the specified format. It is good practice to specify the format using the translation operator, in order to support different formats in different locales.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_DATE</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="n">T</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">),</span>
    <span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;must be YYYY-MM-DD!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For the full description on % directives look under the IS_DATETIME validator.</p>
</section>
<section id="is-datetime">
<h4><code class="docutils literal notranslate"><span class="pre">IS_DATETIME</span></code><a class="headerlink" href="#is-datetime" title="Permalink to this headline"></a></h4>
<p>This validator checks that a field value contains a valid datetime in the specified format. It is good practice to specify the format using the translation operator, in order to support different formats in different locales.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_DATETIME</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="n">T</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">),</span>
                   <span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;must be YYYY-MM-DD HH:MM:SS!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The following symbols can be used for the format string (this shows the symbol, their meaning, and an example string):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>%Y  year with century (e.g. &#39;1963&#39;)
%y  year without century (e.g. &#39;63&#39;)
%d  day of the month (e.g. &#39;28&#39;)
%m  month (e.g &#39;08&#39;)
%b  abbreviated month name (e.g.&#39;Aug&#39;)
%B  full month name (e.g. &#39;August&#39;)
%H  hour (24-hour clock, e.g. &#39;14&#39;)
%I  hour (12-hour clock, e.g. &#39;02&#39;)
%p  either &#39;AM&#39; or &#39;PM&#39;
%M  minute (e.g. &#39;30&#39;)
%S  second (e.g. &#39;59&#39;)
</pre></div>
</div>
</section>
<section id="is-date-in-range">
<h4><code class="docutils literal notranslate"><span class="pre">IS_DATE_IN_RANGE</span></code><a class="headerlink" href="#is-date-in-range" title="Permalink to this headline"></a></h4>
<p>Works very much like the previous validator but allows to specify a range:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_DATE_IN_RANGE</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="n">T</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">),</span>
                <span class="n">minimum</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">maximum</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">),</span>
                <span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;must be YYYY-MM-DD!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For the full description on % directives look under the IS_DATETIME validator.</p>
</section>
<section id="is-datetime-in-range">
<h4><code class="docutils literal notranslate"><span class="pre">IS_DATETIME_IN_RANGE</span></code><a class="headerlink" href="#is-datetime-in-range" title="Permalink to this headline"></a></h4>
<p>Works very much like the previous validator but allows to specify a range:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_DATETIME_IN_RANGE</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="n">T</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">),</span>
                    <span class="n">minimum</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
                    <span class="n">maximum</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">45</span><span class="p">),</span>
                    <span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;must be YYYY-MM-DD HH:MM::SS!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For the full description on % directives look under the IS_DATETIME validator.</p>
</section>
</section>
<section id="range-set-and-equality-validators">
<h3>Range, set and equality validators<a class="headerlink" href="#range-set-and-equality-validators" title="Permalink to this headline"></a></h3>
<section id="is-equal-to">
<h4><code class="docutils literal notranslate"><span class="pre">IS_EQUAL_TO</span></code><a class="headerlink" href="#is-equal-to" title="Permalink to this headline"></a></h4>
<p>Checks whether the validated value is equal to a given value (which can be a variable):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_EQUAL_TO</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
                    <span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;passwords do not match&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="is-not-empty">
<h4><code class="docutils literal notranslate"><span class="pre">IS_NOT_EMPTY</span></code><a class="headerlink" href="#is-not-empty" title="Permalink to this headline"></a></h4>
<p>This validator checks that the content of the field value is neither None nor an empty string nor an empty list. A string value is checked for after a <code class="docutils literal notranslate"><span class="pre">.strip()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_NOT_EMPTY</span><span class="p">(</span><span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;cannot be empty!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can provide a regular expression for the matching of the empty string.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_NOT_EMPTY</span><span class="p">(</span><span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;Enter a value&#39;</span><span class="p">,</span> <span class="n">empty_regex</span><span class="o">=</span><span class="s1">&#39;NULL(?i)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="is-null-or">
<h4><code class="docutils literal notranslate"><span class="pre">IS_NULL_OR</span></code><a class="headerlink" href="#is-null-or" title="Permalink to this headline"></a></h4>
<p>Deprecated, an alias for <code class="docutils literal notranslate"><span class="pre">IS_EMPTY_OR</span></code> described below.</p>
</section>
<section id="is-empty-or">
<h4><code class="docutils literal notranslate"><span class="pre">IS_EMPTY_OR</span></code><a class="headerlink" href="#is-empty-or" title="Permalink to this headline"></a></h4>
<p>Sometimes you need to allow empty values on a field along with other requirements. For example a field may be a date but it can also be empty.
The <code class="docutils literal notranslate"><span class="pre">IS_EMPTY_OR</span></code> validator allows this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_EMPTY_OR</span><span class="p">(</span><span class="n">IS_DATE</span><span class="p">())</span>
</pre></div>
</div>
<p>An empty value is either None or an empty string or an empty list. A string value is checked for after a <code class="docutils literal notranslate"><span class="pre">.strip()</span></code>.</p>
<p>You can provide a regular expression for the matching of the empty string with the <code class="docutils literal notranslate"><span class="pre">empty_regex</span></code> argument (like for IS_NOT_EMPTY validator).</p>
<p>You may also specify a value to be used for the empty case.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_EMPTY_OR</span><span class="p">(</span><span class="n">IS_ALPHANUMERIC</span><span class="p">(),</span> <span class="n">null</span><span class="o">=</span><span class="s1">&#39;anonymous&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="is-expr">
<h4><code class="docutils literal notranslate"><span class="pre">IS_EXPR</span></code><a class="headerlink" href="#is-expr" title="Permalink to this headline"></a></h4>
<p>This validator let you express a general condition by means of a callable which takes a value to validate and returns the error message or <code class="docutils literal notranslate"><span class="pre">None</span></code> to accept the input value.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_EXPR</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">T</span><span class="p">(</span><span class="s1">&#39;not divisible by 3&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Notice</strong> that returned message will not be translated if you do not arrange otherwise.</p>
<p>For backward compatibility the condition may be expressed as a string containing a logical expression in terms of a variable value. It validates a field value if the expression evaluates to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_EXPR</span><span class="p">(</span><span class="s1">&#39;int(value) % 3 == 0&#39;</span><span class="p">,</span>
               <span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;not divisible by 3&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>One should first check that the value is an integer so that an exception will not occur.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="p">[</span><span class="n">IS_INT_IN_RANGE</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">IS_EXPR</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">T</span><span class="p">(</span><span class="s1">&#39;not divisible by 3&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span> <span class="o">%</span> <span class="mi">3</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)]</span>
</pre></div>
</div>
</section>
<section id="is-decimal-in-range">
<h4><code class="docutils literal notranslate"><span class="pre">IS_DECIMAL_IN_RANGE</span></code><a class="headerlink" href="#is-decimal-in-range" title="Permalink to this headline"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INPUT</span><span class="p">(</span><span class="n">_type</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">_name</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_DECIMAL_IN_RANGE</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">dot</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>It converts the input into a Python Decimal or generates an error if
the decimal does not fall within the specified inclusive range.
The comparison is made with Python Decimal arithmetic.</p>
<p>The minimum and maximum limits can be None, meaning no lower or upper limit,
respectively.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">dot</span></code> argument is optional and allows you to internationalize the symbol used to separate the decimals.</p>
</section>
<section id="is-float-in-range">
<h4><code class="docutils literal notranslate"><span class="pre">IS_FLOAT_IN_RANGE</span></code><a class="headerlink" href="#is-float-in-range" title="Permalink to this headline"></a></h4>
<p>Checks that the field value is a floating point number within a definite range, <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;=</span> <span class="pre">value</span> <span class="pre">&lt;=</span> <span class="pre">100</span></code> in the following example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_FLOAT_IN_RANGE</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">dot</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
                            <span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;negative or too large!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">dot</span></code> argument is optional and allows you to internationalize the symbol used to separate the decimals.</p>
</section>
<section id="is-int-in-range">
<h4><code class="docutils literal notranslate"><span class="pre">IS_INT_IN_RANGE</span></code><a class="headerlink" href="#is-int-in-range" title="Permalink to this headline"></a></h4>
<dl>
<dt>Checks that the field value is an integer number within a definite range,</dt><dd><p><code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;=</span> <span class="pre">value</span> <span class="pre">&lt;</span> <span class="pre">100</span></code> in the following example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_INT_IN_RANGE</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span>
                        <span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;negative or too large!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="is-in-set">
<h4><code class="docutils literal notranslate"><span class="pre">IS_IN_SET</span></code><a class="headerlink" href="#is-in-set" title="Permalink to this headline"></a></h4>
<p>This validator will automatically set the form field to an option field (ie, with a drop-down menu).</p>
<p><code class="docutils literal notranslate"><span class="pre">IS_IN_SET</span></code> checks that the field values are in a set:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_IN_SET</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="n">zero</span><span class="o">=</span><span class="n">T</span><span class="p">(</span><span class="s1">&#39;choose one&#39;</span><span class="p">),</span>
             <span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;must be a or b or c&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The zero argument is optional and it determines the text of the option selected by default, an option which
is not accepted by the <code class="docutils literal notranslate"><span class="pre">IS_IN_SET</span></code> validator itself. If you do not want a “choose one” option, set <code class="docutils literal notranslate"><span class="pre">zero=None</span></code>.</p>
<p>The elements of the set can be combined with a numerical validator, as long as IS_IN_SET is first in the list.
Doing so will force conversion by the last validator to the numerical type. So, IS_IN_SET can be followed by
<code class="docutils literal notranslate"><span class="pre">IS_INT_IN_RANGE</span></code> (which converts the value to int) or <code class="docutils literal notranslate"><span class="pre">IS_FLOAT_IN_RANGE</span></code> (which converts the value to float). For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="p">[</span> <span class="n">IS_IN_SET</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;must be prime and less than 10&#39;</span><span class="p">),</span>
            <span class="n">IS_INT_IN_RANGE</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="p">]</span>
</pre></div>
</div>
</section>
<section id="checkbox-validation">
<h4>Checkbox validation<a class="headerlink" href="#checkbox-validation" title="Permalink to this headline"></a></h4>
<p>To force a filled-in form checkbox (such as an acceptance of terms and conditions), use this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span><span class="o">=</span><span class="n">IS_IN_SET</span><span class="p">([</span><span class="s1">&#39;on&#39;</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="dictionaries-and-tuples-with-is-in-set">
<h4>Dictionaries and tuples with IS_IN_SET<a class="headerlink" href="#dictionaries-and-tuples-with-is-in-set" title="Permalink to this headline"></a></h4>
<p>You may also use a dictionary or a list of tuples to make the drop down list more descriptive:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dictionary example:</span>
<span class="n">requires</span> <span class="o">=</span> <span class="n">IS_IN_SET</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span><span class="s1">&#39;Apple&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="s1">&#39;Banana&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span><span class="s1">&#39;Cherry&#39;</span><span class="p">},</span> <span class="n">zero</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="c1"># List of tuples example:</span>
<span class="n">requires</span> <span class="o">=</span> <span class="n">IS_IN_SET</span><span class="p">([(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;Apple&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;Banana&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;Cherry&#39;</span><span class="p">)])</span>
</pre></div>
</div>
</section>
<section id="sorted-options">
<h4>Sorted options<a class="headerlink" href="#sorted-options" title="Permalink to this headline"></a></h4>
<p>To keep the options alphabetically sorted by their labels into the drop down list, use the <code class="docutils literal notranslate"><span class="pre">sort</span></code> argument with IS_IN_SET.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">IS_IN_SET</span><span class="p">([(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;Hulk&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;Superman&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;Batman&#39;</span><span class="p">)],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="is-in-set-and-tagging">
<h4><code class="docutils literal notranslate"><span class="pre">IS_IN_SET</span></code> and Tagging<a class="headerlink" href="#is-in-set-and-tagging" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">IS_IN_SET</span></code> validator has an optional attribute <code class="docutils literal notranslate"><span class="pre">multiple=False</span></code>. If set to True, multiple values can be stored in one
field. The field should be of type <code class="docutils literal notranslate"><span class="pre">list:integer</span></code> or <code class="docutils literal notranslate"><span class="pre">list:string</span></code> as discussed in [[Chapter 6 ../06#list-type-and-contains]].
An explicit example of tagging is discussed there. We strongly suggest using the jQuery multiselect plugin to render multiple fields.</p>
<p><strong>Note</strong> that when <code class="docutils literal notranslate"><span class="pre">multiple=True</span></code>, <code class="docutils literal notranslate"><span class="pre">IS_IN_SET</span></code> will accept zero or more values, i.e. it will accept the field when nothing has been selected.
<code class="docutils literal notranslate"><span class="pre">multiple</span></code> can also be a tuple of the form <code class="docutils literal notranslate"><span class="pre">(a,</span> <span class="pre">b)</span></code> where <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are the minimum and (exclusive) maximum number of items
that can be selected respectively.</p>
</section>
</section>
<section id="complexity-and-security-validators">
<h3>Complexity and security validators<a class="headerlink" href="#complexity-and-security-validators" title="Permalink to this headline"></a></h3>
<section id="is-strong">
<h4><code class="docutils literal notranslate"><span class="pre">IS_STRONG</span></code><a class="headerlink" href="#is-strong" title="Permalink to this headline"></a></h4>
<p>Enforces complexity requirements on a field (usually a password field).</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_STRONG</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">special</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">min</span></code> is minimum length of the value</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">special</span></code> is the minimum number of required special characters, by default special characters are any of the following
<code class="docutils literal notranslate"><span class="pre">^!!&#64;#$%^&amp;*()_+-=?&lt;&gt;,.:;{}[]|</span></code> (you can customize these using <code class="docutils literal notranslate"><span class="pre">specials</span> <span class="pre">=</span> <span class="pre">'...'</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">upper</span></code> is the minimum number of upper case characters</p></li>
</ul>
<p>other accepted arguments are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">invalid</span></code> for the list of forbidden characters, by default <code class="docutils literal notranslate"><span class="pre">invalid='</span> <span class="pre">&quot;'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max</span></code> for the maximum length of the value</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lower</span></code> for the minimum number of lower case characters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">number</span></code> for the minimum number of digit characters</p></li>
</ul>
<p>Obviously you can provide an <code class="docutils literal notranslate"><span class="pre">error_message</span></code> as for any other validator, although IS_STRONG is clever enough to provide a clear message to describe the validation failure.</p>
<p>A special argument you can use is <code class="docutils literal notranslate"><span class="pre">entropy</span></code>, that is a minimum value for the complexity of the value to accept (a number), experiment this with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">IS_STRONG</span><span class="p">(</span><span class="n">entropy</span><span class="o">=</span><span class="mf">100.0</span><span class="p">)(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="go">(&#39;hello&#39;, Entropy (24.53) less than required (100.0))</span>
</pre></div>
</div>
<p><strong>Notice</strong> that if the argument <code class="docutils literal notranslate"><span class="pre">entropy</span></code> is not given then IS_STRONG implicitly sets the following defaults: <code class="docutils literal notranslate"><span class="pre">min</span> <span class="pre">=</span> <span class="pre">8,</span> <span class="pre">upper</span> <span class="pre">=</span> <span class="pre">1,</span> <span class="pre">lower</span> <span class="pre">=</span> <span class="pre">1,</span>
<span class="pre">number</span> <span class="pre">=</span> <span class="pre">1,</span> <span class="pre">special</span> <span class="pre">=</span> <span class="pre">1</span></code> which otherwise are all sets to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</section>
<section id="crypt">
<h4><code class="docutils literal notranslate"><span class="pre">CRYPT</span></code><a class="headerlink" href="#crypt" title="Permalink to this headline"></a></h4>
<p>This is also a filter. It performs a secure hash on the input and it is used to prevent passwords from being passed in the clear to the database.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">CRYPT</span><span class="p">()</span>
</pre></div>
</div>
<p>By default, CRYPT uses 1000 iterations of the pbkdf2 algorithm combined with SHA512 to produce a 20-byte-long hash.
Old versions of web2py used md5 or HMAC+SHA512 depending on whether a key was specified or not.</p>
<p>If a key is specified, CRYPT uses the HMAC algorithm. The key may contain a prefix that determines the algorithm to use with HMAC, for example SHA512:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">CRYPT</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;sha512:thisisthekey&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This is the recommended syntax. The key must be a unique string associated with the database used. The key can never be changed. If you lose the key, the previously hashed values become useless.
By default, CRYPT uses random salt, such that each result is different. To use a constant salt value, specify its value:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">CRYPT</span><span class="p">(</span><span class="n">salt</span><span class="o">=</span><span class="s1">&#39;mysaltvalue&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Or, to use no salt:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">CRYPT</span><span class="p">(</span><span class="n">salt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>The CRYPT validator hashes its input, and this makes it somewhat special. If you need to validate a password field before it
is hashed, you can use CRYPT in a list of validators, but must make sure it is the last of the list, so that it is called last. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="p">[</span><span class="n">IS_STRONG</span><span class="p">(),</span> <span class="n">CRYPT</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;sha512:thisisthekey&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CRYPT</span></code> also takes a <code class="docutils literal notranslate"><span class="pre">min_length</span></code> argument, which defaults to zero.</p>
<p>The resulting hash takes the form <code class="docutils literal notranslate"><span class="pre">alg$salt$hash</span></code>, where <code class="docutils literal notranslate"><span class="pre">alg</span></code> is the hash algorithm used, <code class="docutils literal notranslate"><span class="pre">salt</span></code> is the salt string (which can be empty),
and <code class="docutils literal notranslate"><span class="pre">hash</span></code> is the algorithm’s output. Consequently, the hash is self-identifying, allowing, for example, the algorithm to be changed without
invalidating previous hashes. The key, however, must remain the same.</p>
</section>
</section>
<section id="special-type-validators">
<h3>Special type validators<a class="headerlink" href="#special-type-validators" title="Permalink to this headline"></a></h3>
<section id="is-list-of">
<h4><code class="docutils literal notranslate"><span class="pre">IS_LIST_OF</span></code><a class="headerlink" href="#is-list-of" title="Permalink to this headline"></a></h4>
<p>This validator helps you to ensure length limits on values of type list, for this purpose use its <code class="docutils literal notranslate"><span class="pre">minimum</span></code>, <code class="docutils literal notranslate"><span class="pre">maximum</span></code>, and <code class="docutils literal notranslate"><span class="pre">error_message</span></code>
arguments, for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_LIST_OF</span><span class="p">(</span><span class="n">minimum</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>A list value may comes from a form containing multiple fields with the same name or a multiple selection box.
Note that this validator automatically converts a non-list value into a single valued list:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">IS_LIST_OF</span><span class="p">()(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="go">([&#39;hello&#39;], None)</span>
</pre></div>
</div>
<p>If the first argument of IS_LIST_OF is another validator, then it applies the other validator to each element of the list.
A typical usage is validation of a <code class="docutils literal notranslate"><span class="pre">list:</span></code> type field, for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Field</span><span class="p">(</span><span class="s1">&#39;emails&#39;</span><span class="p">,</span> <span class="s1">&#39;list:string&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_LIST_OF</span><span class="p">(</span><span class="n">IS_EMAIL</span><span class="p">()),</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="is-list-of-emails">
<h4><code class="docutils literal notranslate"><span class="pre">IS_LIST_OF_EMAILS</span></code><a class="headerlink" href="#is-list-of-emails" title="Permalink to this headline"></a></h4>
<p>This validator is specifically designed to work with the following field:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Field</span><span class="p">(</span><span class="s1">&#39;emails&#39;</span><span class="p">,</span> <span class="s1">&#39;list:string&#39;</span><span class="p">,</span>
      <span class="n">widget</span><span class="o">=</span><span class="n">SQLFORM</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">widget</span><span class="p">,</span>
    <span class="n">requires</span><span class="o">=</span><span class="n">IS_LIST_OF_EMAILS</span><span class="p">(),</span>
    <span class="n">filter_in</span><span class="o">=</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> \\
        <span class="n">IS_LIST_OF_EMAILS</span><span class="o">.</span><span class="n">split_emails</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">l</span> <span class="k">else</span> <span class="n">l</span><span class="p">,</span>
    <span class="n">represent</span><span class="o">=</span><span class="k">lambda</span> <span class="n">v</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> \\
        <span class="n">XML</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">A</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_href</span><span class="o">=</span><span class="s1">&#39;mailto:&#39;</span><span class="o">+</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">xml</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">v</span> <span class="ow">or</span> <span class="p">[])]))</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Notice that due to the <code class="docutils literal notranslate"><span class="pre">widget</span></code> customization this field will be rendered by a textarea in SQLFORMs (see next [[Widgets #Widgets]]
section). This let you insert and edit multiple emails in a single input field (very much like normal mail client programs do),
separating each email address with <code class="docutils literal notranslate"><span class="pre">,</span></code>, <code class="docutils literal notranslate"><span class="pre">;</span></code>, and blanks (space, newline, and tab characters).
As a consequence now we need a validator which is able to operate on a single value input and a way to split the validated value into
a list to be next processed by DAL, these are what the <code class="docutils literal notranslate"><span class="pre">requires</span></code> and <code class="docutils literal notranslate"><span class="pre">filter_in</span></code> arguments stand for.
As alternative to <code class="docutils literal notranslate"><span class="pre">filter_in</span></code>, you can pass the following function to the <code class="docutils literal notranslate"><span class="pre">onvalidation</span></code> argument of form <code class="docutils literal notranslate"><span class="pre">accepts</span></code>, <code class="docutils literal notranslate"><span class="pre">process</span></code>,
or <code class="docutils literal notranslate"><span class="pre">validate</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">emails_onvalidation</span><span class="p">(</span><span class="n">form</span><span class="p">):</span>
    <span class="n">form</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">emails</span> <span class="o">=</span> <span class="n">IS_LIST_OF_EMAILS</span><span class="o">.</span><span class="n">split_emails</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">emails</span><span class="p">)</span>
</pre></div>
</div>
<p>The effect of the <code class="docutils literal notranslate"><span class="pre">represent</span></code> argument (at lines 6 and 7) is to add a “mailto:…” link to each email address when the record is rendered in HTML pages.</p>
</section>
<section id="any-of">
<h4><code class="docutils literal notranslate"><span class="pre">ANY_OF</span></code><a class="headerlink" href="#any-of" title="Permalink to this headline"></a></h4>
<p>This validator takes a list of validators and accepts a value if any of the validators in the list does (i.e. it acts like a logical
OR with respect to given validators).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">ANY_OF</span><span class="p">([</span><span class="n">IS_ALPHANUMERIC</span><span class="p">(),</span> <span class="n">IS_EMAIL</span><span class="p">()])</span>
</pre></div>
</div>
<p>When none of the validators accepts the value you get the error message form the last attempted one (the last in the list), you
can customize the error message as usual:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ANY_OF</span><span class="p">([</span><span class="n">IS_ALPHANUMERIC</span><span class="p">(),</span> <span class="n">IS_EMAIL</span><span class="p">()])(</span><span class="s1">&#39;@ab.co&#39;</span><span class="p">)</span>
<span class="go">(&#39;@ab.co&#39;, &#39;Enter a valid email address&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ANY_OF</span><span class="p">([</span><span class="n">IS_ALPHANUMERIC</span><span class="p">(),</span> <span class="n">IS_EMAIL</span><span class="p">()],</span>
<span class="gp">... </span>       <span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;Enter login or email&#39;</span><span class="p">)(</span><span class="s1">&#39;@ab.co&#39;</span><span class="p">)</span>
<span class="go">(&#39;@ab.co&#39;, &#39;Enter login or email&#39;)</span>
</pre></div>
</div>
</section>
<section id="is-image">
<h4><code class="docutils literal notranslate"><span class="pre">IS_IMAGE</span></code><a class="headerlink" href="#is-image" title="Permalink to this headline"></a></h4>
<p>This validator checks if a file uploaded through the file input was saved in one of the selected image formats and has dimensions (width and height)
within given limits.</p>
<p>It does not check for maximum file size (use IS_LENGTH for that). It returns
a validation failure if no data was uploaded. It supports the file formats BMP, GIF, JPEG, PNG, and it does not require the Python Imaging Library.</p>
<p>Code parts taken from ref.``source1``:cite</p>
<p>It takes the following arguments:
- extensions: iterable containing allowed image file extensions in lowercase
- maxsize: iterable containing maximum width and height of the image
- minsize: iterable containing minimum width and height of the image</p>
<p>Use (-1, -1) as minsize to bypass the image-size check.</p>
<p>Here are some Examples:
- Check if uploaded file is in any of supported image formats:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_IMAGE</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Check if uploaded file is either JPEG or PNG:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_IMAGE</span><span class="p">(</span><span class="n">extensions</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">))</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Check if uploaded file is PNG with maximum size of 200x200 pixels:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_IMAGE</span><span class="p">(</span><span class="n">extensions</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;png&#39;</span><span class="p">),</span> <span class="n">maxsize</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
</pre></div>
</div>
<p>Note: on displaying an edit form for a table including <code class="docutils literal notranslate"><span class="pre">requires</span> <span class="pre">=</span> <span class="pre">IS_IMAGE()</span></code>, a <code class="docutils literal notranslate"><span class="pre">delete</span></code> checkbox will NOT appear because to delete the file
would cause the validation to fail. To display the <code class="docutils literal notranslate"><span class="pre">delete</span></code> checkbox use this validation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_EMPTY_OR</span><span class="p">(</span><span class="n">IS_IMAGE</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="is-file">
<h4><code class="docutils literal notranslate"><span class="pre">IS_FILE</span></code><a class="headerlink" href="#is-file" title="Permalink to this headline"></a></h4>
<p>Checks if name and extension of file uploaded through file input matches given criteria.</p>
<p>Does <em>not</em> ensure the file type in any way. Returns validation failure if no data was uploaded.</p>
<p>Its arguments are:</p>
<ul class="simple">
<li><p>filename: string/compiled regex or a list of strings/regex of valid filenames</p></li>
<li><p>extension: string/compiled regex or a list of strings/regex of valid extensions</p></li>
<li><p>lastdot: which dot should be used as a filename / extension separator: <code class="docutils literal notranslate"><span class="pre">True</span></code> indicates last dot (e.g., “file.tar.gz”
will be broken in “file.tar” + “gz”) while <code class="docutils literal notranslate"><span class="pre">False</span></code> means first dot (e.g., “file.tar.gz” will be broken into “file” + “tar.gz”).</p></li>
<li><p>case: 0 means keep the case; 1 means transform the string into lowercase (default); 2 means transform the string into uppercase.</p></li>
</ul>
<p>If there is no dot present, extension checks will be done against empty string and filename checks against whole value.</p>
<p>Examples:
Check if file has a pdf extension (case insensitive):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INPUT</span><span class="p">(</span><span class="n">_type</span><span class="o">=</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">_name</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span>
        <span class="n">requires</span><span class="o">=</span><span class="n">IS_FILE</span><span class="p">(</span><span class="n">extension</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Check if file is called ‘thumbnail’ and has a jpg or png extension
(case insensitive):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INPUT</span><span class="p">(</span><span class="n">_type</span><span class="o">=</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">_name</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span>
        <span class="n">requires</span><span class="o">=</span><span class="n">IS_FILE</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;thumbnail&#39;</span><span class="p">,</span>
        <span class="n">extension</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<p>Check if file has a tar.gz extension and name starting with backup:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INPUT</span><span class="p">(</span><span class="n">_type</span><span class="o">=</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">_name</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span>
        <span class="n">requires</span><span class="o">=</span><span class="n">IS_FILE</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;backup.*&#39;</span><span class="p">),</span>
        <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;tar.gz&#39;</span><span class="p">,</span> <span class="n">lastdot</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
<p>Check if file has no extension and name matching README
(case sensitive):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INPUT</span><span class="p">(</span><span class="n">_type</span><span class="o">=</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">_name</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span>
    <span class="n">requires</span><span class="o">=</span><span class="n">IS_FILE</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;README&#39;</span><span class="p">,</span>
    <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="is-upload-filename">
<h4><code class="docutils literal notranslate"><span class="pre">IS_UPLOAD_FILENAME</span></code><a class="headerlink" href="#is-upload-filename" title="Permalink to this headline"></a></h4>
<p>This is the older implementation for checking files, included for backwards compatibility.  For new applications, use <code class="docutils literal notranslate"><span class="pre">IS_FILE()</span></code>.</p>
<p>This validator checks if the name and extension of a file uploaded through the file input matches the given criteria.</p>
<p>It does not ensure the file type in any way. Returns validation failure
if no data was uploaded.</p>
<p>Its arguments are:</p>
<ul class="simple">
<li><p>filename: filename (before dot) regex.</p></li>
<li><p>extension: extension (after dot) regex.</p></li>
<li><p>lastdot: which dot should be used as a filename / extension separator: <code class="docutils literal notranslate"><span class="pre">True</span></code> indicates last dot (e.g., “file.tar.gz” will be
broken in “file.tar” + “gz”) while <code class="docutils literal notranslate"><span class="pre">False</span></code> means first dot (e.g., “file.tar.gz” will be broken into “file” + “tar.gz”).</p></li>
<li><p>case: 0 means keep the case; 1 means transform the string into lowercase (default); 2 means transform the string into uppercase.</p></li>
</ul>
<p>If there is no dot present, extension checks will be done against an empty string and filename checks will be done against the whole value.</p>
<p>Examples:</p>
<p>Check if file has a pdf extension (case insensitive):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_UPLOAD_FILENAME</span><span class="p">(</span><span class="n">extension</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Check if file has a tar.gz extension and name starting with backup:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_UPLOAD_FILENAME</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;backup.*&#39;</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;tar.gz&#39;</span><span class="p">,</span> <span class="n">lastdot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Check if file has no extension and name matching README (case sensitive):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_UPLOAD_FILENAME</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;^README$&#39;</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;^$&#39;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="is-ipv4">
<h4><code class="docutils literal notranslate"><span class="pre">IS_IPV4</span></code><a class="headerlink" href="#is-ipv4" title="Permalink to this headline"></a></h4>
<p>This validator checks if a field’s value is an IP version 4 address in decimal form. Can
be set to force addresses from a certain range.</p>
<p>IPv4 regex taken from <code class="docutils literal notranslate"><span class="pre">regexlib</span></code>. The signature for the <code class="docutils literal notranslate"><span class="pre">IS_IPV4</span></code> constructor is the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">IS_IPV4</span><span class="p">(</span><span class="n">minip</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">maxip</span><span class="o">=</span><span class="s1">&#39;255.255.255.255&#39;</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">is_localhost</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_private</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_automatic</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;Enter valid IPv4 address&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">minip</span></code> is the lowest allowed address</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">maxip</span></code> is the highest allowed address</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">invert</span></code> is a flag to invert allowed address range, i.e. if set to True allows addresses only from outside
of given range; note that range boundaries are not matched this way</p></li>
</ul>
<p>You can pass an IP address either as a string (e.g. ‘192.168.0.1’) or as a list or tuple of 4 integers (e.g. [192, 168, 0, 1]).</p>
<p>To check for multiple address ranges pass to <code class="docutils literal notranslate"><span class="pre">minip</span></code> and <code class="docutils literal notranslate"><span class="pre">maxip</span></code> a list or tuple of boundary addresses, for example
to allow only addresses between ‘192.168.20.10’ and ‘192.168.20.19’ or between ‘192.168.30.100’ and ‘192.168.30.199’ use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_IPV4</span><span class="p">(</span><span class="n">minip</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;192.168.20.10&#39;</span><span class="p">,</span> <span class="s1">&#39;192.168.30.100&#39;</span><span class="p">),</span>
                <span class="n">maxip</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;192.168.20.19&#39;</span><span class="p">,</span> <span class="s1">&#39;192.168.30.199&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>Notice</strong> that only a range for which both lower and upper limits are set is configured, that is the number of configured ranges
is determined by the shorter of the iterables passed to <code class="docutils literal notranslate"><span class="pre">minip</span></code> and <code class="docutils literal notranslate"><span class="pre">maxip</span></code>.</p>
<p>The arguments <code class="docutils literal notranslate"><span class="pre">is_localhost</span></code>, <code class="docutils literal notranslate"><span class="pre">is_private</span></code>, and <code class="docutils literal notranslate"><span class="pre">is_automatic</span></code> accept the following values:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">None</span></code> to ignore the option</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">True</span></code> to force the option</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">False</span></code> to forbid the option</p></li>
</ul>
<p>The option meanings are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">is_localhost</span></code>: match localhost address (127.0.0.1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_private</span></code>: match address in 172.16.0.0 - 172.31.255.255 and 192.168.0.0 - 192.168.255.255 ranges</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_automatic</span></code>: match address in 169.254.0.0 - 169.254.255.255 range</p></li>
</ul>
<p>Examples:</p>
<p>Check for valid IPv4 address:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_IPV4</span><span class="p">()</span>
</pre></div>
</div>
<p>Check for valid private network IPv4 address:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_IPV4</span><span class="p">(</span><span class="n">minip</span><span class="o">=</span><span class="s1">&#39;192.168.0.1&#39;</span><span class="p">,</span> <span class="n">maxip</span><span class="o">=</span><span class="s1">&#39;192.168.255.255&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="is-ipv6">
<h4><code class="docutils literal notranslate"><span class="pre">IS_IPV6</span></code><a class="headerlink" href="#is-ipv6" title="Permalink to this headline"></a></h4>
<p>This validator checks if a field’s value is an IP version 6 address.</p>
<p>The signature for the <code class="docutils literal notranslate"><span class="pre">IS_IPV6</span></code> constructor is the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">IS_IPV6</span><span class="p">(</span><span class="n">is_private</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">is_link_local</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">is_reserved</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">is_multicast</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">is_routeable</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">is_6to4</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">is_teredo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">subnets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;Enter valid IPv6 address&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The arguments <code class="docutils literal notranslate"><span class="pre">is_private</span></code>, <code class="docutils literal notranslate"><span class="pre">is_link_local</span></code>, <code class="docutils literal notranslate"><span class="pre">is_reserved</span></code>, <code class="docutils literal notranslate"><span class="pre">is_multicast</span></code>, <code class="docutils literal notranslate"><span class="pre">is_routeable</span></code>, <code class="docutils literal notranslate"><span class="pre">is_6to4</span></code>,
and <code class="docutils literal notranslate"><span class="pre">is_teredo</span></code> accept the following values:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">None</span></code> to ignore the option</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">True</span></code> to force the option</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">False</span></code> to forbid the option, this does not work for <code class="docutils literal notranslate"><span class="pre">is_routeable</span></code></p></li>
</ul>
<p>The option meanings are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">is_private</span></code>: match an address allocated for private networks</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_link_local</span></code>: match an address reserved for link-local (i.e. in fe80::/10 range), this is a private network too (also matched by <code class="docutils literal notranslate"><span class="pre">is_private</span></code> above)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_reserved</span></code>: match an address otherwise IETF reserved</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_multicast</span></code>: match an address reserved for multicast use (i.e. in ff00::/8 range)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_6to4</span></code>: match an address that appear to contain a 6to4 embedded address (i.e. in 2002::/16 range)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_teredo</span></code>: match a teredo address (i.e. in 2001::/32 range)</p></li>
</ul>
<p>Forcing <code class="docutils literal notranslate"><span class="pre">is_routeable</span></code> (setting to True) is a shortcut to forbid (setting to False) <code class="docutils literal notranslate"><span class="pre">is_private</span></code>, <code class="docutils literal notranslate"><span class="pre">is_reserved</span></code>, and <code class="docutils literal notranslate"><span class="pre">is_multicast</span></code> all.</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">subnets</span></code> argument to pass a subnet or list of subnets to check for address membership, this way an address must be a subnet member to validate.</p>
<p>Examples:</p>
<p>Check for valid IPv6 address:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_IPV6</span><span class="p">()</span>
</pre></div>
</div>
<p>Check for valid private network IPv6 address:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_IPV6</span><span class="p">(</span><span class="n">is_link_local</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Check for valid IPv6 address in subnet:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_IPV6</span><span class="p">(</span><span class="n">subnets</span><span class="o">=</span><span class="s1">&#39;fb00::/8&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="is-ipaddress">
<h4><code class="docutils literal notranslate"><span class="pre">IS_IPADDRESS</span></code><a class="headerlink" href="#is-ipaddress" title="Permalink to this headline"></a></h4>
<p>This validator checks if a field’s value is an IP address (either version 4 or version 6).
Can be set to force addresses from within a specific range.
Checks are done using the appropriate <code class="docutils literal notranslate"><span class="pre">IS_IPV4</span></code> or <code class="docutils literal notranslate"><span class="pre">IS_IPV6</span></code> validator.</p>
<p>The signature for the <code class="docutils literal notranslate"><span class="pre">IS_IPADDRESS</span></code> constructor is the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">IS_IPADDRESS</span><span class="p">(</span><span class="n">minip</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">maxip</span><span class="o">=</span><span class="s1">&#39;255.255.255.255&#39;</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">is_localhost</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_private</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_automatic</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">is_ipv4</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">is_link_local</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_reserved</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_multicast</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">is_routeable</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_6to4</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_teredo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">subnets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_ipv6</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;Enter valid IP address&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>With respect to <code class="docutils literal notranslate"><span class="pre">IS_IPV4</span></code> and <code class="docutils literal notranslate"><span class="pre">IS_IPV6</span></code> validators the only added arguments are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">is_ipv4</span></code>, set to True to force version 4 or set to False to forbid version 4</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_ipv6</span></code>, set to True to force version 6 or set to False to forbid version 6</p></li>
</ul>
<p>Refer to IS_IPV4 and IS_IPV6 validators for the meaning of other arguments.</p>
<p>Examples:</p>
<p>Check for valid IP address (both IPv4 and IPv6):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_IPADDRESS</span><span class="p">()</span>
</pre></div>
</div>
<p>Check for valid IP address (IPv6 only):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_IPADDRESS</span><span class="p">(</span><span class="n">is_ipv6</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="other-validators">
<h3>Other validators<a class="headerlink" href="#other-validators" title="Permalink to this headline"></a></h3>
<section id="cleanup">
<h4><code class="docutils literal notranslate"><span class="pre">CLEANUP</span></code><a class="headerlink" href="#cleanup" title="Permalink to this headline"></a></h4>
<p>This is a filter. It never fails. By default it just removes all characters whose decimal ASCII codes
are not in the list [10, 13, 32-127]. It always perform an initial strip (i.e. heading and trailing blank characters removal) on the value.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">=</span> <span class="n">CLEANUP</span><span class="p">()</span>
</pre></div>
</div>
<p>You can pass a regular expression to decide what has to be removed, for example to clear all non-digit characters use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">CLEANUP</span><span class="p">(</span><span class="s1">&#39;[^</span><span class="se">\\</span><span class="s1">d]&#39;</span><span class="p">)(</span><span class="s1">&#39;Hello 123 world 456&#39;</span><span class="p">)</span>
<span class="go">(&#39;123456&#39;, None)</span>
</pre></div>
</div>
</section>
</section>
<section id="database-validators">
<h3>Database validators<a class="headerlink" href="#database-validators" title="Permalink to this headline"></a></h3>
<section id="is-not-in-db">
<h4><code class="docutils literal notranslate"><span class="pre">IS_NOT_IN_DB</span></code><a class="headerlink" href="#is-not-in-db" title="Permalink to this headline"></a></h4>
<p>Synopsis:
<code class="docutils literal notranslate"><span class="pre">IS_NOT_IN_DB(db|set,</span> <span class="pre">'table.field')</span></code></p>
<p>Consider the following example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">define_table</span><span class="p">(</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span>
<span class="n">db</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_NOT_IN_DB</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s1">&#39;person.name&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>It requires that when you insert a new person, his/her name is not already in the database, <code class="docutils literal notranslate"><span class="pre">db</span></code>, in the field <code class="docutils literal notranslate"><span class="pre">person.name</span></code>.</p>
<p>A set can be used instead of <code class="docutils literal notranslate"><span class="pre">db</span></code>.</p>
<p>As with all other validators this requirement is enforced at the form processing level, not at the database level.
This means that there is a small probability that, if two visitors try to concurrently insert records with the same person.name,
this results in a race condition and both records are accepted. It is therefore safer to also inform the database that this field should have a unique value:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">define_table</span><span class="p">(</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">db</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_NOT_IN_DB</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s1">&#39;person.name&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now if a race condition occurs, the database raises an OperationalError and one of the two inserts is rejected.</p>
<p>The first argument of <code class="docutils literal notranslate"><span class="pre">IS_NOT_IN_DB</span></code> can be a database connection or a Set. In the latter case, you would be checking only the set defined by the Set.</p>
<p>A complete argument list for <code class="docutils literal notranslate"><span class="pre">IS_NOT_IN_DB()</span></code> is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">IS_NOT_IN_DB</span><span class="p">(</span><span class="n">dbset</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">error_message</span><span class="o">=</span><span class="s1">&#39;value already in database or empty&#39;</span><span class="p">,</span>
            <span class="n">allowed_override</span><span class="o">=</span><span class="p">[],</span> <span class="n">ignore_common_filters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The following code, for example, does not allow registration of two persons with the same name within 10 days of each other:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<span class="n">db</span><span class="o">.</span><span class="n">define_table</span><span class="p">(</span><span class="s1">&#39;person&#39;</span><span class="p">,</span>
    <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span>
    <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;registration_stamp&#39;</span><span class="p">,</span> <span class="s1">&#39;datetime&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">now</span><span class="p">))</span>
<span class="n">recent</span> <span class="o">=</span> <span class="n">db</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">registration_stamp</span> <span class="o">&gt;</span> <span class="n">now</span><span class="o">-</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">db</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_NOT_IN_DB</span><span class="p">(</span><span class="n">recent</span><span class="p">,</span> <span class="s1">&#39;person.name&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="is-in-db">
<h4><code class="docutils literal notranslate"><span class="pre">IS_IN_DB</span></code><a class="headerlink" href="#is-in-db" title="Permalink to this headline"></a></h4>
<p>Synopsis:
<code class="docutils literal notranslate"><span class="pre">IS_IN_DB(db|set,</span> <span class="pre">'table.value_field',</span> <span class="pre">'%(representing_field)s',</span> <span class="pre">zero='choose</span> <span class="pre">one')</span></code>
where the third and fourth arguments are optional.</p>
<p><code class="docutils literal notranslate"><span class="pre">multiple=</span></code> is also possible if the field type is a list. The default is False. It can be set to True or to a tuple (min, max)
to restrict the number of values selected. So <code class="docutils literal notranslate"><span class="pre">multiple=(1,</span> <span class="pre">10)</span></code> enforces at least one and at most ten selections.</p>
<p>Other optional arguments are discussed below.</p>
<p>Example
Consider the following tables and requirement:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">define_table</span><span class="p">(</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">db</span><span class="o">.</span><span class="n">define_table</span><span class="p">(</span><span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span> <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;owner&#39;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">person</span><span class="p">))</span>
<span class="n">db</span><span class="o">.</span><span class="n">dog</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_IN_DB</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s1">&#39;person.id&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%(name)s</span><span class="s1">&#39;</span><span class="p">,</span>
                                <span class="n">zero</span><span class="o">=</span><span class="n">T</span><span class="p">(</span><span class="s1">&#39;choose one&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>the IS_IN_DB requirement could also be written to use a Set instead of db</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">dog</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_IN_DB</span><span class="p">(</span><span class="n">db</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;person.id&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%(name)s</span><span class="s1">&#39;</span><span class="p">,</span>
                                <span class="n">zero</span><span class="o">=</span><span class="n">T</span><span class="p">(</span><span class="s1">&#39;choose one&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>It is enforced at the level of dog INSERT/UPDATE/DELETE forms. This example requires that a <code class="docutils literal notranslate"><span class="pre">dog.owner</span></code> be a valid id
in the field <code class="docutils literal notranslate"><span class="pre">person.id</span></code> in the database <code class="docutils literal notranslate"><span class="pre">db</span></code>. Because of this validator, the <code class="docutils literal notranslate"><span class="pre">dog.owner</span></code> field is represented
as a drop-down list. The third argument of the validator is a string that describes the elements in the drop-down list,
this is passed to the <code class="docutils literal notranslate"><span class="pre">label</span></code> argument of the validator. In the example you want to see the person <code class="docutils literal notranslate"><span class="pre">%(name)s</span></code> instead
of the person <code class="docutils literal notranslate"><span class="pre">%(id)s</span></code>. <code class="docutils literal notranslate"><span class="pre">%(...)s</span></code> is replaced by the value of the field in brackets for each record. Other accepted
values for the <code class="docutils literal notranslate"><span class="pre">label</span></code> are a Field instance (e.g. you could use db.person.name instead of ‘%(name)s’) or even a callable
that takes a row and returns the description for the option.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">zero</span></code> option works very much like for the <code class="docutils literal notranslate"><span class="pre">IS_IN_SET</span></code> validator.</p>
<p>Other optional arguments accepted by <code class="docutils literal notranslate"><span class="pre">IS_IN_DB</span></code> are: <code class="docutils literal notranslate"><span class="pre">orderby</span></code>, <code class="docutils literal notranslate"><span class="pre">groupby</span></code>, <code class="docutils literal notranslate"><span class="pre">distinct</span></code>, <code class="docutils literal notranslate"><span class="pre">cache</span></code>, and <code class="docutils literal notranslate"><span class="pre">left</span></code>;
these are passed to the db select (see <a class="reference internal" href="chapter-07.html#orderby-groupby-limitby"><span class="std std-ref">their description</span></a> on the DAL chapter).</p>
<p><strong>Notice</strong> that <code class="docutils literal notranslate"><span class="pre">groupby</span></code>, <code class="docutils literal notranslate"><span class="pre">distinct</span></code>, and <code class="docutils literal notranslate"><span class="pre">left</span></code> do not apply to Google App Engine.</p>
<p>To alphabetically sort the options listed in the drop-down list you can set the <code class="docutils literal notranslate"><span class="pre">sort</span></code> argument to <code class="docutils literal notranslate"><span class="pre">True</span></code> (sorting is case-insensitive),
this may be usefull when no <code class="docutils literal notranslate"><span class="pre">orderby</span></code> is feasible or practical.</p>
<p>The first argument of the validator can be a database connection or a DAL Set, as in <code class="docutils literal notranslate"><span class="pre">IS_NOT_IN_DB</span></code>. This can be useful for example when
wishing to limit the records in the drop-down list. In this example, we use <code class="docutils literal notranslate"><span class="pre">IS_IN_DB</span></code> in a controller to limit the records dynamically
each time the controller is called:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">field</span> <span class="o">==</span> <span class="s1">&#39;xyz&#39;</span><span class="p">)</span> <span class="c1"># in practice &#39;xyz&#39; would be a variable</span>
    <span class="n">db</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_IN_DB</span><span class="p">(</span><span class="n">db</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="o">...</span><span class="p">)</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">Form</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">process</span><span class="p">()</span><span class="o">.</span><span class="n">accepted</span><span class="p">:</span> <span class="o">...</span>
    <span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>If you want the field validated, but you do not want a drop-down, you must put the validator in a list.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">dog</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">requires</span> <span class="o">=</span> <span class="p">[</span><span class="n">IS_IN_DB</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s1">&#39;person.id&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%(name)s</span><span class="s1">&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Occasionally you want the drop-down (so you do not want to use the list syntax above) yet you want to use additional validators.
For this purpose the <code class="docutils literal notranslate"><span class="pre">IS_IN_DB</span></code> validator takes an extra argument <code class="docutils literal notranslate"><span class="pre">_and</span></code> that can point to a list of other validators applied
if the validated value passes the <code class="docutils literal notranslate"><span class="pre">IS_IN_DB</span></code> validation. For example to validate all dog owners in db that are not in a subset:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">subset</span> <span class="o">=</span> <span class="n">db</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">person</span><span class="o">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">dog</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">requires</span> <span class="o">=</span> <span class="n">IS_IN_DB</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s1">&#39;person.id&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%(name)s</span><span class="s1">&#39;</span><span class="p">,</span>
                                <span class="n">_and</span><span class="o">=</span><span class="n">IS_NOT_IN_DB</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span> <span class="s1">&#39;person.id&#39;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="is-in-db-and-tagging">
<h4><code class="docutils literal notranslate"><span class="pre">IS_IN_DB</span></code> and Tagging<a class="headerlink" href="#is-in-db-and-tagging" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">IS_IN_DB</span></code> validator has an optional attribute <code class="docutils literal notranslate"><span class="pre">multiple=False</span></code>. If set to <code class="docutils literal notranslate"><span class="pre">True</span></code> multiple values can be stored in one field.
This field should be of type <code class="docutils literal notranslate"><span class="pre">list:reference</span></code> as discussed in <a class="reference internal" href="chapter-07.html#list-type-and-contains"><span class="std std-ref">list:&lt;type&gt; and contains</span></a>. An explicit example of
tagging is discussed there. Multiple references are handled automatically in create and update forms, but they are transparent to
the DAL. We strongly suggest using the jQuery multiselect plugin to render multiple fields.</p>
</section>
</section>
<section id="validation-functions">
<h3>Validation functions<a class="headerlink" href="#validation-functions" title="Permalink to this headline"></a></h3>
<p>In order to explicitly define a validation function, we pass to the <code class="docutils literal notranslate"><span class="pre">validation</span></code> parameter a
function that takes the form and returns a dictionary, mapping field
names to errors. If the dictionary is non-empty, the errors will be
displayed to the user, and no database I/O will take place.</p>
<p>Here is an example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">py4web</span> <span class="kn">import</span> <span class="n">Field</span>
<span class="kn">from</span> <span class="nn">py4web.utils.form</span> <span class="kn">import</span> <span class="n">Form</span><span class="p">,</span> <span class="n">FormStyleBulma</span>
<span class="kn">from</span> <span class="nn">pydal.validators</span> <span class="kn">import</span> <span class="n">IS_INT_IN_RANGE</span>

<span class="k">def</span> <span class="nf">check_nonnegative_quantity</span><span class="p">(</span><span class="n">form</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">form</span><span class="o">.</span><span class="n">errors</span> <span class="ow">and</span> <span class="n">form</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="s1">&#39;product_quantity&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s1">&#39;product_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="s1">&#39;The product quantity must be even&#39;</span><span class="p">)</span>

<span class="nd">@action</span><span class="p">(</span><span class="s1">&#39;form_example&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@action</span><span class="o">.</span><span class="n">uses</span><span class="p">(</span><span class="s1">&#39;form_example.html&#39;</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">form_example</span><span class="p">():</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">Form</span><span class="p">([</span>
        <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;product_name&#39;</span><span class="p">),</span>
        <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;product_quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_INT_IN_RANGE</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">))],</span>
        <span class="n">validation</span><span class="o">=</span><span class="n">check_nonnegative_quantity</span><span class="p">,</span>
        <span class="n">formstyle</span><span class="o">=</span><span class="n">FormStyleBulma</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">accepted</span><span class="p">:</span>
        <span class="c1"># Do something with form.vars[&#39;product_name&#39;] and form.vars[&#39;product_quantity&#39;]</span>
        <span class="n">redirect</span><span class="p">(</span><span class="n">URL</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="chapter-11.html" class="btn btn-neutral float-left" title="Internationalization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="chapter-13.html" class="btn btn-neutral float-right" title="Authentication and authorization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, BSDv3 License.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      
      
     <span class="fa fa-element">
     <input class="container_toggle" type="checkbox" id="switch" name="mode">
     <label for="switch"></label>
     </span>
      
      v: 1.20220222.1
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <dl>
        <dt>Languages</dt>
        
           <strong> 
          <dd><a href="../en/index.html">en</a></dd> </strong>
          
        
          
          
          <dd><a href="../pt/index.html">pt</a></dd> 
        
      </dl>
      
      
      <dl>
        <dt>Versions</dt>
        
          
          <dd><a href="index.html">current</a></dd>
          
        
      </dl>
      
      
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="py4web_en.pdf">pdf</a></dd>
        
          <dd><a href="py4web_en.epub">epub</a></dd>
        
      </dl>
      
      
      <hr/>
    </div>
  </div>

 <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
         .wy-nav-content { max-width: none; }
  </style>



</body>
</html>