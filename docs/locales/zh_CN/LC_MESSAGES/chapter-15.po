# Py4web 中文文档
# Copyright (C) 2020, BSDv3 License
# This file is distributed under the same license as the py4web package.
# 杨文增 <1528046831@qq.com>, 2025.
#
#, fuzzy
msgid ""
msgstr ""
"Project-Id-Version: py4web 20250908\n"
"Report-Msgid-Bugs-To: \n"
"POT-Creation-Date: 2025-09-15 21:19+0800\n"
"PO-Revision-Date: 2025-12-19 20:19+0800\n"
"Last-Translator: 杨文增 <1528046831@qq.com>\n"
"Language: zh_CN\n"
"Language-Team: zh_CN <LL@li.org>\n"
"Plural-Forms: nplurals=1; plural=0;\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=utf-8\n"
"Content-Transfer-Encoding: 8bit\n"
"Generated-By: Babel 2.17.0\n"

#: ../../chapter-15.rst:3
msgid "From web2py to py4web"
msgstr "从 web2py 迁移到 py4web"

#: ../../chapter-15.rst:5
msgid ""
"This chapter is dedicated to help users for porting old web2py "
"applications to py4web."
msgstr "本章旨在帮助用户将旧的 web2py 应用程序移植到 py4web。"

#: ../../chapter-15.rst:7
msgid ""
"Web2py and py4web share many similarities and some differences. For "
"example they share the same database abstraction layer (pyDAL) which "
"means pydal table definitions and queries are identical between the two "
"frameworks. They also share the same template language with the minor "
"caveat that web2py defaults to `{{...}}` delimiters while py4web defaults"
" to `[[...]]` delimiters. They also share the same validators, part of "
"pyDAL, and very similar helpers. The py4web ones are a "
"lighter/faster/minimalist re-implementation but they serve the same "
"purpose and support a very similar syntax. They both provide a `Form` "
"object (equivalent to `SQLFORM` in web2py) and a `Grid` object "
"(equivalent to `SQLFORM.grid` in web2py). They both provide a `XML` "
"object that can sanitize HTML and `URL` helper to generate URL. They both"
" can raise `HTTP` to return non-200 OK pages. They both provide an `Auth`"
" object that can generate register/login/change password/lost "
"password/edit profile forms. Both web2py and py4web track and log all "
"errors."
msgstr "Web2py 和 py4web 有很多相似之处，也有一些不同之处。例如，它们共享相同的数据库抽象层（pyDAL），这意味着两个框架之间的 pyDAL 的表定义和查询是相同的。它们还共享相同的模板语言，但有一点需要注意，web2py 默认为 ``{{...}}`` 分隔符，而 py4web 默认为 ``[[...]]`` 分隔符。它们还共享相同的验证器，pyDAL 的一部分，以及非常相似的 helpers 。py4web 是一个更轻/更快/极简主义的重新实现，但它们具有相同的目的，并支持非常相似的语法。py4web 也提供了一个 Form 对象（相当于 web2py 中的 SQLFORM）和一个 Grid 对象（相当于 web2py 的 SQLFORM.Grid ）。它们均提供一个可清理 HTML 内容的 `XML` 对象，以及一个用于生成 URL 的 URL helper。它们均能通过抛出 `HTTP` 异常来返回非 200 OK 状态码的页面。它们还均提供一个 `Auth` 对象，该对象可生成注册、登录、修改密码、找回密码及编辑个人资料的表单。此外，web2py 和 py4web 这两个框架都会跟踪并记录所有错误。"

#: ../../chapter-15.rst:19
msgid "Some of the main differences are the following:"
msgstr "主要区别如下："

#: ../../chapter-15.rst:21
msgid ""
"web2py works with both Python 2.6+ and 3.6+, while py4web runs on Python "
"3.7+ only. So, if your old web2py application is still using Python 2, "
"your first step involves migrating it to at least Python 3.7, better if "
"the latest 3.9."
msgstr "web2py 同时适用于 Python 2.6+ 和 3.6+ ，而py4web 仅在 Python 3.7+ 上运行。因此，如果你的旧 web2py 应用程序仍在使用 Python 2，你的第一步是将其迁移到至少 Python 3.7 ，最好是最新的 3.9 。"

#: ../../chapter-15.rst:25
msgid ""
"web2py apps consist of collection of files which are executed at every "
"HTTP request (using a custom importer, in a predetermined order). In "
"py4web apps are regular python modules that are imported automatically by"
" the frameworks. By the way, this makes possible the use of standard "
"python debuggers (even inside the most used IDEs)."
msgstr "web2py 应用程序由在每个 HTTP 请求时执行的文件集合组成（使用自定义导入程序，按预定顺序）。在 py4web 应用程序中，是由框架自动导入的常规 python 模块。顺便说一句，这使得使用标准 python 调试器成为可能（即使在最常用的 IDE 中）。"

#: ../../chapter-15.rst:30
msgid ""
"In web2py every app has a fixed folder structure. A function is an action"
" if and only if it is defined in a ``controllers/*.py`` file. py4web is "
"much less constraining. In py4web an app must have an entry point "
"``__init__.py`` and a ``static`` folder. Every other convention such as "
"the location of templates, uploaded files, translation files, sessions, "
"etc. is user specified."
msgstr "在 web2py 中，每个应用程序都有一个固定的文件夹结构。当且仅当它在  ``controllers/*.py`` 文件中定义时，函数才是一个 action 。py4web 的约束要小得多。在py4web 中，应用程序必须有一个入口点 ``__init__.py`` 和一个 ``static`` 文件夹。其他所有约定，如模板、上传文件、翻译文件、会话等的位置，都由用户指定的。"

#: ../../chapter-15.rst:35
msgid ""
"In web2py the scaffolding app (the blue print for creating new apps) is "
"called “welcome”. In py4web it is called “_scaffold”. _scaffold contains "
"a “settings.py” file and a “common.py”. The latter provides an example of"
" how to enable Auth and configure all the options for the specific app. "
"_scaffold has also a “model.py” file and a “controller.py” file but, "
"unlike web2py, those files are not treated in any special manner. Their "
"names follow a convention (not enforced by the framework) and they are "
"imported by the `__init__.py` file as for any regular python module."
msgstr "在 web2py 中，scaffolding 应用程序（创建新应用程序的蓝图）被称为 “welcome”。在 py4web 中，它被称为 “_scaffold ”。_scaffold 包含一个 “settings.py” 文件和一个 “common.py” 文件。后者提供了一个如何启用 Auth 并为特定应用程序配置所有选项的示例。_scaffold 还有一个 “model.py” 文件和一个 “controller.py” 文件，但与 web2py 不同，这些文件没有以任何特殊方式处理。它们的名称遵循一个约定（框架没有强制执行），并且与任何常规 python 模块一样，它们由 `__init__.py` 文件导入。"

#: ../../chapter-15.rst:43
msgid ""
"In web2py every function in ``controllers/*.py`` is an action. In py4web "
"a function is an action if it has the ``@action(\"...\")`` decorator. "
"That means that actions can be defined anywhere. The admin interface will"
" help you locate where a particular action is defined."
msgstr "在 web2py 中， ``controllers/*.py`` 中的每个函数都是一个  action 。在 py4web 中，如果一个函数有 ``@action(\"...\")`` 装饰符，那么它就是一个动作。这意味着 ``@action(\"...\")`` 可以在任何地方定义。管理界面将帮助您定位特定 action 的定义位置。"

#: ../../chapter-15.rst:47
#, python-brace-format
msgid ""
"In web2py the mapping between URLs and file/function names is automatic "
"but it can be overwritten in “routes.py” (like in Django). In py4web the "
"mapping is specified in the decorator as in `@action('my_url_path')` "
"(like in Bottle and Flask). Notice that if the path starts with “/” it is"
" assumed to be an absolute path. If not, it is assumed to be relative and"
" prepended by the “/{appname}/” prefix. Also, if the path ends with "
"“/index”, the latter postfix is assumed to be optional."
msgstr "在 web2py 中，URL 和文件/函数名之间的映射是自动的，但可以在 “routes.py” 中被覆盖（就像在 Django 中一样）。在 py4web 中，映射在装饰器 `@action('my_url_path')` 中被指定（就像在 Bottle 和 Flask 中一样）。请注意，如果路径以 “/” 开头，则假定为绝对路径。如果不是，则假定它是相对的，并且前缀为 “/{appname}/” 。此外，如果路径以 “/index” 结尾，则后缀（“/index”）被视为可选。"

#: ../../chapter-15.rst:54
msgid ""
"In web2py the path extension matters and “http://*.html” is expected to "
"return HTML while “http://*.json” is expected to return JSON, etc. In "
"py4web there is no such convention. If the action returns a dict() and "
"has a template, the dict() will be rendered by the template, else it will"
" be rendered in JSON. More complex behavior can be accomplished using "
"decorators."
msgstr "在 web2py 中，路径扩展很重要，“http://\*.html“ 预计将返回 HTML，同时 “http://\*.json” 预计将返回 JSON 等。在 py4web 中没有这样的约定。如果 action 返回一个 dict() 并有一个模板，则 dict() 将由模板渲染后呈现，否则将以 JSON 呈现。使用装饰器可以实现更复杂的行为。"

#: ../../chapter-15.rst:59
msgid ""
"In web2py there are many wrappers around each action and, for example, "
"they could handle sessions, pluralization, database connections, and more"
" whether the action needs it or not. This makes web2py performances hard "
"to compare with other frameworks. In py4web everything is optional and "
"features must be enabled and configured for each action using the "
"``@action.uses(...)`` decorator. The arguments of ``@action.uses(...)`` "
"are called fixtures in analogy with the fixtures in a house. They add "
"functionality by providing preprocessing and postprocessing to the "
"action. For example ``@action.uses(session, T, db, flash)`` indicates "
"that the action needs to use session, internationalization/pluralization "
"(T), the database (db), and carry on state for flash messages upon "
"redirection."
msgstr "在 web2py 中，每个 action 都有许多包装器，例如，无论 action 是否真的需要，它们都可以处理会话、多元化、数据库连接等。这使得 web2py 的性能很难与其他框架进行比较。在 py4web 中，一切都是可选的，必须使用 ``@action.uses(...)`` 装饰器为每个操作启用和配置功能。 ``@action.uses(...)`` 的参数被称为 fixtures 装置，类似于房子里的夹具装置。它们通过为 action 提供预处理和后处理来添加功能。例如， ``@action.uses(session, T, db, flash)`` 表示该 action 需要在重定向时使用会话、国际化/多元化（T）、数据库（db）和flash 消息的继续状态。"

#: ../../chapter-15.rst:69
msgid ""
"web2py uses its own request/response objects. py4web uses the "
"request/response objects from the underlying Ombott library. While this "
"may change in the future we are committed to keep them the interface with"
" the web server, routing, partial requests, if modified since, and file "
"streaming."
msgstr "web2py 使用自己的 request/response 对象。py4web 使用底层Ombott库中的 request/response 对象。虽然这在未来可能会发生变化，但我们致力于保持它们与 web 服务器的接口、路由、部分请求和文件流（如果此后进行了修改）。"

#: ../../chapter-15.rst:74
msgid ""
"Both web2py and py4web use the same pyDAL therefore tables are defined "
"using the same exact syntax, and so do queries. In web2py tables are re-"
"defined at every HTTP request, when the entire models are executed. In "
"py4web only the action is executed for every HTTP request, while the code"
" defined outside of actions is only executed at startup. That makes "
"py4web much faster, in particular when there are many tables. The "
"downside of this approach is that the developer should be careful to "
"never override pyDAL variables inside action or in any way that depends "
"on the content of the request object, else the code is not thread safe. "
"The only variables that can be changed at will are the following field "
"attributes: readable, writable, requires, update, default. All the others"
" are for practical purposes to be considered global and non thread safe. "
"This is also the reason that makes using :ref:`Lazy Tables` with py4web "
"useless and even dangerous."
msgstr "web2py 和 py4web 都使用相同的 pyDAL，因此表使用相同的语法定义，查询也是如此。在 web2py 中，当执行整个模型时，每个 HTTP 请求都会重新定义表。在 py4web 中，每个 HTTP 请求只执行 action 中的代码，而在 action 之外定义的代码只在启动时执行。这使得 py4web 更快，特别是在有很多表的情况下。这种方法的缺点是，开发人员应该小心，永远不要在 action 中或以任何依赖于请求对象内容的方式覆盖 pyDAL 变量，否则代码就不是线程安全的。唯一可以随意更改的变量是以下字段属性：readable 、 writable 、 requires 、 update 和 default 。出于实际目的，所有其他的都被认为是全局和非线程安全的。因此，在 py4web 中使用 :ref:`Lazy Tables` 毫无用处，甚至很危险。"

#: ../../chapter-15.rst:86
msgid ""
"Both web2py and pyweb have an Auth object which serve the same purpose. "
"Both objects have the ability to generate forms pretty much in the same "
"manner. The py4web ones is defined to be more modular and extensible and "
"support both Forms and APIs, but it lacks the `auth.requires_*` "
"decorators and group membership/permissions. This does not mean that the "
"feature is not available. In fact py4web is even more powerful and that "
"is why the syntax is different. While the web2py Auth objects tries to do"
" everything, the corresponding py4web object is only in charge of "
"establishing the identity of a user, not what the user can do. The latter"
" can be achieved by attaching Tags to users. So group membership is "
"assigned by labeling users with the Tags of the groups they belong to and"
" checking permissions based on the user tags. Py4web provides a mechanism"
" for assigning and checking tags efficiently to any object, including but"
" not limited to, users."
msgstr "web2py 和 py4web 都有一个用于相同目的的 Auth 对象。这两个对象都能够以几乎相同的方式生成表单。py4web 的 Auth 被定义为更加模块化和可扩展，并同时支持 Forms 和 API，但它缺少 `auth.requires_*` 装饰器和组成员资格/权限。这并不意味着该功能不可用。事实上，py4web 甚至更强大，这就是语法不同的原因。虽然 web2py Auth 对象试图做所有事情，但相应的 py4web 对象只负责建立用户的身份，而不是用户可以做什么。后者可以通过向用户附加标签来实现。因此，通过用用户所属组的标签标记用户并根据用户标签检查权限来分配组成员资格。Py4web 提供了一种机制，可以有效地为任何对象（包括但不限于用户）分配和检查标签。"

#: ../../chapter-15.rst:98
msgid ""
"Web2py comes with the Rocket web server. py4web at the time of writing "
"defaults to the `Rocket3 <https://github.com/web2py/rocket3>`__  web "
"server, which is the same multi-threaded web server used by web2py "
"stripped of all the Python2 logic and dependencies. Note that this may "
"change in the future."
msgstr "Web2py 附带了 Rocket 网络服务器。在撰写本文时，py4web 默认使用 `Rocket3 <https://github.com/web2py/rocket3>`__ 服务器，这是 web2py 使用的同一个多线程 web 服务器，去掉了所有 Python2 的逻辑和依赖关系。请注意，这可能会在未来发生变化。"

#: ../../chapter-15.rst:105
msgid "Simple conversion examples"
msgstr "简单的转换示例"

#: ../../chapter-15.rst:108
msgid "“Hello world” example"
msgstr "“Hello world” 示例"

#: ../../chapter-15.rst:110 ../../chapter-15.rst:131 ../../chapter-15.rst:156
#: ../../chapter-15.rst:176 ../../chapter-15.rst:196 ../../chapter-15.rst:222
#: ../../chapter-15.rst:241 ../../chapter-15.rst:266 ../../chapter-15.rst:316
#: ../../chapter-15.rst:341 ../../chapter-15.rst:359
msgid "**web2py**"
msgstr ""

#: ../../chapter-15.rst:118 ../../chapter-15.rst:142 ../../chapter-15.rst:164
#: ../../chapter-15.rst:185 ../../chapter-15.rst:207 ../../chapter-15.rst:230
#: ../../chapter-15.rst:252 ../../chapter-15.rst:280 ../../chapter-15.rst:325
#: ../../chapter-15.rst:348 ../../chapter-15.rst:377
msgid "--> **py4web**"
msgstr ""

#: ../../chapter-15.rst:129
msgid "“Redirect with variables” example"
msgstr "“带变量重定向” 的示例"

#: ../../chapter-15.rst:154
msgid "“Returning variables” example"
msgstr "“返回变量” 的示例"

#: ../../chapter-15.rst:174
msgid "“Returning args” example"
msgstr "“返回参数” 的示例"

#: ../../chapter-15.rst:194
msgid "“Return calling methods” example"
msgstr "“返回调用方法” 的示例"

#: ../../chapter-15.rst:220
msgid "“Setting up a counter” example"
msgstr "“设置计数器” 的示例 "

#: ../../chapter-15.rst:239
msgid "“View” example"
msgstr "“视图” 的示例"

#: ../../chapter-15.rst:264
msgid "“Form and flash” example"
msgstr "“Form 和 flash” 的示例"

#: ../../chapter-15.rst:295
msgid "In the template you can access the flash object with"
msgstr "在模板中，您可以通过以下方式访问 flash 对象"

#: ../../chapter-15.rst:301
msgid "or using the more sophisticated"
msgstr "或者使用更复杂的"

#: ../../chapter-15.rst:307
msgid ""
"The latter requires ``utils.js`` from the scaffolding app to render the "
"custom tag into a div with dismissal behavior."
msgstr "后者需要 scaffolding 应用程序中的 ``utils.js`` 将自定义标签呈现为带有关闭功能的 div。"

#: ../../chapter-15.rst:310
msgid ""
"Also notice that ``Flash`` is special: it is a singleton. So if you "
"instantiate multiple Flash objects they share their data."
msgstr "还要注意， ``Flash`` 很特别：它是一个单例。因此，如果实例化多个 Flash 对象，它们会共享数据。"

#: ../../chapter-15.rst:314
msgid "“grid” example"
msgstr "“grid” 的示例"

#: ../../chapter-15.rst:339
msgid "“Accessing OS files” example"
msgstr "“访问操作系统文件” 的示例"

#: ../../chapter-15.rst:357
msgid "“auth” example"
msgstr "“auth” 的示例"

#: ../../chapter-15.rst:375
msgid "Access with ``http://.../user/login``."
msgstr "通过 ``http://.../user/login`` 访问。 "

#: ../../chapter-15.rst:393
msgid ""
"Access with ``http://.../auth/login``. Notice that in web2py "
"``auth.user`` is the current logged-in user retrieved from session. In "
"py4web instead ``auth.user`` is a fixture which serves the same purpose "
"as ``@requires_login`` in web2py. In py4web only the ``user_id`` is "
"stored in the session and it can be retrieved using ``auth.user_id``. If "
"you need more information about the user, you need to fetch the record "
"from the database with ``auth.get_user()`` The latter returns all "
"readable fields as a Python dictionary."
msgstr "通过 ``http://.../auth/login`` 进行访问。请注意，在 web2py 中， ``auth.user`` 是从会话中检索到的当前登录用户。在 py4web 中， ``auth.user`` 是一个夹具，其作用与 web2py 中的 ``@requires_login`` 相同。在 py4web 中，只有 ``user_id`` 存储在会话中，可以使用 ``auth.user_id`` 检索。如果你需要更多关于用户的信息，你需要使用 ``auth.get_user()`` 从数据库中获取记录，它将所有可读字段作为 Python 字典返回。"

#: ../../chapter-15.rst:402
msgid "Also notice there is a big difference between:"
msgstr "请注意，以下两者之间存在显著差异："

#: ../../chapter-15.rst:408
msgid "and"
msgstr "和"

#: ../../chapter-15.rst:414
msgid ""
"In the first case the decorated action can access the auth object but "
"``auth.user_id`` may be None if the user is not logged in. In the second "
"case we are requiring a valid logged in user and therefore "
"``auth.user_id`` is guaranteed to be a valid user id."
msgstr "在第一种情况下，被修饰的 action 可以访问 auth 对象，但如果用户未登录，``auth.user_id``  可能为 None。在第二种情况下我们需要一个有效的登录用户，因此能保证 ``auth.user_id`` 是一个有效用户 id。"

#: ../../chapter-15.rst:419
msgid ""
"Also notice that if an action uses auth, then it automatically uses its "
"session and its flash objects."
msgstr "还要注意，如果一个操作（action）使用 auth，那么它会自动使用其 session 和 flash 对象。"

